/**
 * @license video-express.js 1.4.2 fac2192
 *
 * Copyright (c) 2010-2023 TokBox, Inc.
 * Subject to the applicable Software Development Kit (SDK) License Agreement:
 * https://www.vonage.com/legal/communications-apis/terms-of-use/
 *
 * Date: Tue, 24 Jan 2023 17:47:34 GMT
 */
'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var events = require('events');
var OT = _interopDefault(require('@opentok/client'));
var initLayout = _interopDefault(require('opentok-layout-js'));
var ResizeObserverPolyfill = _interopDefault(require('resize-observer-polyfill'));
var lodash = require('lodash');
var jss = _interopDefault(require('jss'));
var preset = _interopDefault(require('jss-preset-default'));
var camelCase = _interopDefault(require('jss-plugin-camel-case'));
var OTKAnalytics = _interopDefault(require('opentok-solutions-logging'));
var UAParser = _interopDefault(require('ua-parser-js'));

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }

  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function () {
    var self = this,
        args = arguments;
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);

      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }

      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
      }

      _next(undefined);
    });
  };
}

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  subClass.__proto__ = superClass;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function _assertThisInitialized(self) {
  if (self === void 0) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return self;
}

function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var runtime_1 = /*#__PURE__*/createCommonjsModule(function (module) {
  /**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */
  var runtime = function (exports) {

    var Op = Object.prototype;
    var hasOwn = Op.hasOwnProperty;
    var undefined$1; // More compressible than void 0.

    var $Symbol = typeof Symbol === "function" ? Symbol : {};
    var iteratorSymbol = $Symbol.iterator || "@@iterator";
    var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
    var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

    function define(obj, key, value) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
      return obj[key];
    }

    try {
      // IE 8 has a broken Object.defineProperty that only works on DOM objects.
      define({}, "");
    } catch (err) {
      define = function define(obj, key, value) {
        return obj[key] = value;
      };
    }

    function wrap(innerFn, outerFn, self, tryLocsList) {
      // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
      var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
      var generator = Object.create(protoGenerator.prototype);
      var context = new Context(tryLocsList || []); // The ._invoke method unifies the implementations of the .next,
      // .throw, and .return methods.

      generator._invoke = makeInvokeMethod(innerFn, self, context);
      return generator;
    }

    exports.wrap = wrap; // Try/catch helper to minimize deoptimizations. Returns a completion
    // record like context.tryEntries[i].completion. This interface could
    // have been (and was previously) designed to take a closure to be
    // invoked without arguments, but in all the cases we care about we
    // already have an existing method we want to call, so there's no need
    // to create a new function object. We can even get away with assuming
    // the method takes exactly one argument, since that happens to be true
    // in every case, so we don't have to touch the arguments object. The
    // only additional allocation required is the completion record, which
    // has a stable shape and so hopefully should be cheap to allocate.

    function tryCatch(fn, obj, arg) {
      try {
        return {
          type: "normal",
          arg: fn.call(obj, arg)
        };
      } catch (err) {
        return {
          type: "throw",
          arg: err
        };
      }
    }

    var GenStateSuspendedStart = "suspendedStart";
    var GenStateSuspendedYield = "suspendedYield";
    var GenStateExecuting = "executing";
    var GenStateCompleted = "completed"; // Returning this object from the innerFn has the same effect as
    // breaking out of the dispatch switch statement.

    var ContinueSentinel = {}; // Dummy constructor functions that we use as the .constructor and
    // .constructor.prototype properties for functions that return Generator
    // objects. For full spec compliance, you may wish to configure your
    // minifier not to mangle the names of these two functions.

    function Generator() {}

    function GeneratorFunction() {}

    function GeneratorFunctionPrototype() {} // This is a polyfill for %IteratorPrototype% for environments that
    // don't natively support it.


    var IteratorPrototype = {};

    IteratorPrototype[iteratorSymbol] = function () {
      return this;
    };

    var getProto = Object.getPrototypeOf;
    var NativeIteratorPrototype = getProto && getProto(getProto(values([])));

    if (NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
      // This environment has a native %IteratorPrototype%; use it instead
      // of the polyfill.
      IteratorPrototype = NativeIteratorPrototype;
    }

    var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);
    GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
    GeneratorFunctionPrototype.constructor = GeneratorFunction;
    GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"); // Helper for defining the .next, .throw, and .return methods of the
    // Iterator interface in terms of a single ._invoke method.

    function defineIteratorMethods(prototype) {
      ["next", "throw", "return"].forEach(function (method) {
        define(prototype, method, function (arg) {
          return this._invoke(method, arg);
        });
      });
    }

    exports.isGeneratorFunction = function (genFun) {
      var ctor = typeof genFun === "function" && genFun.constructor;
      return ctor ? ctor === GeneratorFunction || // For the native GeneratorFunction constructor, the best we can
      // do is to check its .name property.
      (ctor.displayName || ctor.name) === "GeneratorFunction" : false;
    };

    exports.mark = function (genFun) {
      if (Object.setPrototypeOf) {
        Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
      } else {
        genFun.__proto__ = GeneratorFunctionPrototype;
        define(genFun, toStringTagSymbol, "GeneratorFunction");
      }

      genFun.prototype = Object.create(Gp);
      return genFun;
    }; // Within the body of any async function, `await x` is transformed to
    // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
    // `hasOwn.call(value, "__await")` to determine if the yielded value is
    // meant to be awaited.


    exports.awrap = function (arg) {
      return {
        __await: arg
      };
    };

    function AsyncIterator(generator, PromiseImpl) {
      function invoke(method, arg, resolve, reject) {
        var record = tryCatch(generator[method], generator, arg);

        if (record.type === "throw") {
          reject(record.arg);
        } else {
          var result = record.arg;
          var value = result.value;

          if (value && typeof value === "object" && hasOwn.call(value, "__await")) {
            return PromiseImpl.resolve(value.__await).then(function (value) {
              invoke("next", value, resolve, reject);
            }, function (err) {
              invoke("throw", err, resolve, reject);
            });
          }

          return PromiseImpl.resolve(value).then(function (unwrapped) {
            // When a yielded Promise is resolved, its final value becomes
            // the .value of the Promise<{value,done}> result for the
            // current iteration.
            result.value = unwrapped;
            resolve(result);
          }, function (error) {
            // If a rejected Promise was yielded, throw the rejection back
            // into the async generator function so it can be handled there.
            return invoke("throw", error, resolve, reject);
          });
        }
      }

      var previousPromise;

      function enqueue(method, arg) {
        function callInvokeWithMethodAndArg() {
          return new PromiseImpl(function (resolve, reject) {
            invoke(method, arg, resolve, reject);
          });
        }

        return previousPromise = // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, // Avoid propagating failures to Promises returned by later
        // invocations of the iterator.
        callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
      } // Define the unified helper method that is used to implement .next,
      // .throw, and .return (see defineIteratorMethods).


      this._invoke = enqueue;
    }

    defineIteratorMethods(AsyncIterator.prototype);

    AsyncIterator.prototype[asyncIteratorSymbol] = function () {
      return this;
    };

    exports.AsyncIterator = AsyncIterator; // Note that simple async functions are implemented on top of
    // AsyncIterator objects; they just return a Promise for the value of
    // the final result produced by the iterator.

    exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {
      if (PromiseImpl === void 0) PromiseImpl = Promise;
      var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);
      return exports.isGeneratorFunction(outerFn) ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function (result) {
        return result.done ? result.value : iter.next();
      });
    };

    function makeInvokeMethod(innerFn, self, context) {
      var state = GenStateSuspendedStart;
      return function invoke(method, arg) {
        if (state === GenStateExecuting) {
          throw new Error("Generator is already running");
        }

        if (state === GenStateCompleted) {
          if (method === "throw") {
            throw arg;
          } // Be forgiving, per 25.3.3.3.3 of the spec:
          // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume


          return doneResult();
        }

        context.method = method;
        context.arg = arg;

        while (true) {
          var delegate = context.delegate;

          if (delegate) {
            var delegateResult = maybeInvokeDelegate(delegate, context);

            if (delegateResult) {
              if (delegateResult === ContinueSentinel) continue;
              return delegateResult;
            }
          }

          if (context.method === "next") {
            // Setting context._sent for legacy support of Babel's
            // function.sent implementation.
            context.sent = context._sent = context.arg;
          } else if (context.method === "throw") {
            if (state === GenStateSuspendedStart) {
              state = GenStateCompleted;
              throw context.arg;
            }

            context.dispatchException(context.arg);
          } else if (context.method === "return") {
            context.abrupt("return", context.arg);
          }

          state = GenStateExecuting;
          var record = tryCatch(innerFn, self, context);

          if (record.type === "normal") {
            // If an exception is thrown from innerFn, we leave state ===
            // GenStateExecuting and loop back for another invocation.
            state = context.done ? GenStateCompleted : GenStateSuspendedYield;

            if (record.arg === ContinueSentinel) {
              continue;
            }

            return {
              value: record.arg,
              done: context.done
            };
          } else if (record.type === "throw") {
            state = GenStateCompleted; // Dispatch the exception by looping back around to the
            // context.dispatchException(context.arg) call above.

            context.method = "throw";
            context.arg = record.arg;
          }
        }
      };
    } // Call delegate.iterator[context.method](context.arg) and handle the
    // result, either by returning a { value, done } result from the
    // delegate iterator, or by modifying context.method and context.arg,
    // setting context.delegate to null, and returning the ContinueSentinel.


    function maybeInvokeDelegate(delegate, context) {
      var method = delegate.iterator[context.method];

      if (method === undefined$1) {
        // A .throw or .return when the delegate iterator has no .throw
        // method always terminates the yield* loop.
        context.delegate = null;

        if (context.method === "throw") {
          // Note: ["return"] must be used for ES3 parsing compatibility.
          if (delegate.iterator["return"]) {
            // If the delegate iterator has a return method, give it a
            // chance to clean up.
            context.method = "return";
            context.arg = undefined$1;
            maybeInvokeDelegate(delegate, context);

            if (context.method === "throw") {
              // If maybeInvokeDelegate(context) changed context.method from
              // "return" to "throw", let that override the TypeError below.
              return ContinueSentinel;
            }
          }

          context.method = "throw";
          context.arg = new TypeError("The iterator does not provide a 'throw' method");
        }

        return ContinueSentinel;
      }

      var record = tryCatch(method, delegate.iterator, context.arg);

      if (record.type === "throw") {
        context.method = "throw";
        context.arg = record.arg;
        context.delegate = null;
        return ContinueSentinel;
      }

      var info = record.arg;

      if (!info) {
        context.method = "throw";
        context.arg = new TypeError("iterator result is not an object");
        context.delegate = null;
        return ContinueSentinel;
      }

      if (info.done) {
        // Assign the result of the finished delegate to the temporary
        // variable specified by delegate.resultName (see delegateYield).
        context[delegate.resultName] = info.value; // Resume execution at the desired location (see delegateYield).

        context.next = delegate.nextLoc; // If context.method was "throw" but the delegate handled the
        // exception, let the outer generator proceed normally. If
        // context.method was "next", forget context.arg since it has been
        // "consumed" by the delegate iterator. If context.method was
        // "return", allow the original .return call to continue in the
        // outer generator.

        if (context.method !== "return") {
          context.method = "next";
          context.arg = undefined$1;
        }
      } else {
        // Re-yield the result returned by the delegate method.
        return info;
      } // The delegate iterator is finished, so forget it and continue with
      // the outer generator.


      context.delegate = null;
      return ContinueSentinel;
    } // Define Generator.prototype.{next,throw,return} in terms of the
    // unified ._invoke helper method.


    defineIteratorMethods(Gp);
    define(Gp, toStringTagSymbol, "Generator"); // A Generator should always return itself as the iterator object when the
    // @@iterator function is called on it. Some browsers' implementations of the
    // iterator prototype chain incorrectly implement this, causing the Generator
    // object to not be returned from this call. This ensures that doesn't happen.
    // See https://github.com/facebook/regenerator/issues/274 for more details.

    Gp[iteratorSymbol] = function () {
      return this;
    };

    Gp.toString = function () {
      return "[object Generator]";
    };

    function pushTryEntry(locs) {
      var entry = {
        tryLoc: locs[0]
      };

      if (1 in locs) {
        entry.catchLoc = locs[1];
      }

      if (2 in locs) {
        entry.finallyLoc = locs[2];
        entry.afterLoc = locs[3];
      }

      this.tryEntries.push(entry);
    }

    function resetTryEntry(entry) {
      var record = entry.completion || {};
      record.type = "normal";
      delete record.arg;
      entry.completion = record;
    }

    function Context(tryLocsList) {
      // The root entry object (effectively a try statement without a catch
      // or a finally block) gives us a place to store values thrown from
      // locations where there is no enclosing try statement.
      this.tryEntries = [{
        tryLoc: "root"
      }];
      tryLocsList.forEach(pushTryEntry, this);
      this.reset(true);
    }

    exports.keys = function (object) {
      var keys = [];

      for (var key in object) {
        keys.push(key);
      }

      keys.reverse(); // Rather than returning an object with a next method, we keep
      // things simple and return the next function itself.

      return function next() {
        while (keys.length) {
          var key = keys.pop();

          if (key in object) {
            next.value = key;
            next.done = false;
            return next;
          }
        } // To avoid creating an additional object, we just hang the .value
        // and .done properties off the next function object itself. This
        // also ensures that the minifier will not anonymize the function.


        next.done = true;
        return next;
      };
    };

    function values(iterable) {
      if (iterable) {
        var iteratorMethod = iterable[iteratorSymbol];

        if (iteratorMethod) {
          return iteratorMethod.call(iterable);
        }

        if (typeof iterable.next === "function") {
          return iterable;
        }

        if (!isNaN(iterable.length)) {
          var i = -1,
              next = function next() {
            while (++i < iterable.length) {
              if (hasOwn.call(iterable, i)) {
                next.value = iterable[i];
                next.done = false;
                return next;
              }
            }

            next.value = undefined$1;
            next.done = true;
            return next;
          };

          return next.next = next;
        }
      } // Return an iterator with no values.


      return {
        next: doneResult
      };
    }

    exports.values = values;

    function doneResult() {
      return {
        value: undefined$1,
        done: true
      };
    }

    Context.prototype = {
      constructor: Context,
      reset: function reset(skipTempReset) {
        this.prev = 0;
        this.next = 0; // Resetting context._sent for legacy support of Babel's
        // function.sent implementation.

        this.sent = this._sent = undefined$1;
        this.done = false;
        this.delegate = null;
        this.method = "next";
        this.arg = undefined$1;
        this.tryEntries.forEach(resetTryEntry);

        if (!skipTempReset) {
          for (var name in this) {
            // Not sure about the optimal order of these conditions:
            if (name.charAt(0) === "t" && hasOwn.call(this, name) && !isNaN(+name.slice(1))) {
              this[name] = undefined$1;
            }
          }
        }
      },
      stop: function stop() {
        this.done = true;
        var rootEntry = this.tryEntries[0];
        var rootRecord = rootEntry.completion;

        if (rootRecord.type === "throw") {
          throw rootRecord.arg;
        }

        return this.rval;
      },
      dispatchException: function dispatchException(exception) {
        if (this.done) {
          throw exception;
        }

        var context = this;

        function handle(loc, caught) {
          record.type = "throw";
          record.arg = exception;
          context.next = loc;

          if (caught) {
            // If the dispatched exception was caught by a catch block,
            // then let that catch block handle the exception normally.
            context.method = "next";
            context.arg = undefined$1;
          }

          return !!caught;
        }

        for (var i = this.tryEntries.length - 1; i >= 0; --i) {
          var entry = this.tryEntries[i];
          var record = entry.completion;

          if (entry.tryLoc === "root") {
            // Exception thrown outside of any try block that could handle
            // it, so set the completion value of the entire function to
            // throw the exception.
            return handle("end");
          }

          if (entry.tryLoc <= this.prev) {
            var hasCatch = hasOwn.call(entry, "catchLoc");
            var hasFinally = hasOwn.call(entry, "finallyLoc");

            if (hasCatch && hasFinally) {
              if (this.prev < entry.catchLoc) {
                return handle(entry.catchLoc, true);
              } else if (this.prev < entry.finallyLoc) {
                return handle(entry.finallyLoc);
              }
            } else if (hasCatch) {
              if (this.prev < entry.catchLoc) {
                return handle(entry.catchLoc, true);
              }
            } else if (hasFinally) {
              if (this.prev < entry.finallyLoc) {
                return handle(entry.finallyLoc);
              }
            } else {
              throw new Error("try statement without catch or finally");
            }
          }
        }
      },
      abrupt: function abrupt(type, arg) {
        for (var i = this.tryEntries.length - 1; i >= 0; --i) {
          var entry = this.tryEntries[i];

          if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) {
            var finallyEntry = entry;
            break;
          }
        }

        if (finallyEntry && (type === "break" || type === "continue") && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc) {
          // Ignore the finally entry if control is not jumping to a
          // location outside the try/catch block.
          finallyEntry = null;
        }

        var record = finallyEntry ? finallyEntry.completion : {};
        record.type = type;
        record.arg = arg;

        if (finallyEntry) {
          this.method = "next";
          this.next = finallyEntry.finallyLoc;
          return ContinueSentinel;
        }

        return this.complete(record);
      },
      complete: function complete(record, afterLoc) {
        if (record.type === "throw") {
          throw record.arg;
        }

        if (record.type === "break" || record.type === "continue") {
          this.next = record.arg;
        } else if (record.type === "return") {
          this.rval = this.arg = record.arg;
          this.method = "return";
          this.next = "end";
        } else if (record.type === "normal" && afterLoc) {
          this.next = afterLoc;
        }

        return ContinueSentinel;
      },
      finish: function finish(finallyLoc) {
        for (var i = this.tryEntries.length - 1; i >= 0; --i) {
          var entry = this.tryEntries[i];

          if (entry.finallyLoc === finallyLoc) {
            this.complete(entry.completion, entry.afterLoc);
            resetTryEntry(entry);
            return ContinueSentinel;
          }
        }
      },
      "catch": function _catch(tryLoc) {
        for (var i = this.tryEntries.length - 1; i >= 0; --i) {
          var entry = this.tryEntries[i];

          if (entry.tryLoc === tryLoc) {
            var record = entry.completion;

            if (record.type === "throw") {
              var thrown = record.arg;
              resetTryEntry(entry);
            }

            return thrown;
          }
        } // The context.catch method must only be called with a location
        // argument that corresponds to a known catch block.


        throw new Error("illegal catch attempt");
      },
      delegateYield: function delegateYield(iterable, resultName, nextLoc) {
        this.delegate = {
          iterator: values(iterable),
          resultName: resultName,
          nextLoc: nextLoc
        };

        if (this.method === "next") {
          // Deliberately forget the last sent value so that we don't
          // accidentally pass it on to the delegate.
          this.arg = undefined$1;
        }

        return ContinueSentinel;
      }
    }; // Regardless of whether this script is executing as a CommonJS module
    // or not, return the runtime object so that we can declare the variable
    // regeneratorRuntime in the outer scope, which allows this module to be
    // injected easily by `bin/regenerator --include-runtime script.js`.

    return exports;
  }( // If this script is executing as a CommonJS module, use module.exports
  // as the regeneratorRuntime namespace. Otherwise create a new empty
  // object. Either way, the resulting object will be used to initialize
  // the regeneratorRuntime variable at the top of this file.
   module.exports );

  try {
    regeneratorRuntime = runtime;
  } catch (accidentalStrictMode) {
    // This module should not be running in strict mode, so the above
    // assignment should always work unless something is misconfigured. Just
    // in case runtime.js accidentally runs in strict mode, we can escape
    // strict mode using a global Function call. This could conceivably fail
    // if a Content Security Policy forbids using Function, but in that case
    // the proper solution is to fix the accidental strict mode problem. If
    // you've misconfigured your bundler to force strict mode and applied a
    // CSP to forbid Function, and you're not willing to fix either of those
    // problems, please detail your unique predicament in a GitHub issue.
    Function("r", "regeneratorRuntime = r")(runtime);
  }
});

var getTargetElementFromDOM = function getTargetElementFromDOM(element) {
  if (element instanceof HTMLElement) {
    return element;
  } else if (typeof element === 'string') {
    var ele = document.getElementById(element);
    if (!ele) throw new Error("Invalid element. Element not found: " + element);
    return ele;
  } else {
    throw new Error("element must be string or HTMLElement. Found: " + element);
  }
};
var createDiv = function createDiv(id, style) {
  if (style === void 0) {
    style = {};
  }

  var element = document.createElement('div');
  element.id = id;
  Object.entries(style).forEach(function (_ref) {
    var key = _ref[0],
        value = _ref[1];
    element.style.setProperty(key, value);
  });
  return element;
};

jss.setup(preset());
jss.use(camelCase());
var createStyles = function createStyles(styles) {
  var _jss$createStyleSheet = jss.createStyleSheet(styles).attach(),
      classes = _jss$createStyleSheet.classes;

  return classes;
};

/* eslint-disable no-console */
var logLevel = {
  NONE: 0,
  ERROR: 1,
  WARN: 2,
  INFO: 3,
  DEBUG: 4
};
var currentLogLevel = logLevel.NONE;
var setLogLevel = function setLogLevel(level) {
  if (Object.values(logLevel).includes(level)) {
    currentLogLevel = level;
  } else {
    console.error('Attempting to set invalid log level: ', level);
  }
};
var logger = {
  error: function error() {
    if (currentLogLevel >= logLevel.ERROR) {
      var _console;

      (_console = console).error.apply(_console, arguments);
    }
  },
  warn: function warn() {
    if (currentLogLevel >= logLevel.WARN) {
      var _console2;

      (_console2 = console).warn.apply(_console2, arguments);
    }
  },
  info: function info() {
    if (currentLogLevel >= logLevel.INFO) {
      var _console3;

      (_console3 = console).info.apply(_console3, arguments);
    }
  },
  debug: function debug() {
    if (currentLogLevel >= logLevel.DEBUG) {
      var _console4;

      (_console4 = console).debug.apply(_console4, arguments);
    }
  }
};

var removeItem = function removeItem(array, item) {
  var index = array.indexOf(item);

  if (index > -1) {
    array.splice(index, 1);
  }
};

var HiddenTileTracker = /*#__PURE__*/function () {
  function HiddenTileTracker(maxVideoParticipantsOnScreen) {
    this.hiddenElements = [];
    this.visibleElements = [];
    /*
     * Array of video elements ordered by display priority
     * i.e. first entry is the current active speaker or a new participant.
     * The last entry is the participant with longest time since speaking or joining
     */

    this._elementsOrderedByDisplayPriority = [];
    this.PARTICIPANT_DISPLAY_LIMIT = maxVideoParticipantsOnScreen;
  }

  var _proto = HiddenTileTracker.prototype;

  _proto._removeLastActiveVisibleElement = function _removeLastActiveVisibleElement() {
    var _this = this;

    var lastActiveVisibleElement = this.visibleElements[0];
    this.visibleElements.forEach(function (element) {
      if (_this._elementsOrderedByDisplayPriority.indexOf(element) < _this._elementsOrderedByDisplayPriority.indexOf(lastActiveVisibleElement)) {
        lastActiveVisibleElement = element;
      }
    });
    removeItem(this.visibleElements, lastActiveVisibleElement);
    this.hiddenElements.push(lastActiveVisibleElement);
  };

  _proto.onActiveSpeakerChanged = function onActiveSpeakerChanged(element) {
    this._currentActiveSpeakerElement = element;

    if (element) {
      removeItem(this._elementsOrderedByDisplayPriority, element);

      this._elementsOrderedByDisplayPriority.push(element);

      if (this.hiddenElements.includes(element)) {
        removeItem(this.hiddenElements, this._currentActiveSpeakerElement);
        this.visibleElements.push(element);
      }

      if (this.visibleElements.length > this.PARTICIPANT_DISPLAY_LIMIT) {
        this._removeLastActiveVisibleElement();
      }
    }
  };

  _proto.onSubscriberCreated = function onSubscriberCreated(element) {
    if (this.visibleElements.length >= this.PARTICIPANT_DISPLAY_LIMIT) {
      this._removeLastActiveVisibleElement();
    }

    this.visibleElements.push(element);

    this._elementsOrderedByDisplayPriority.push(element);
  };

  _proto.onSubscriberRemoved = function onSubscriberRemoved(element) {
    removeItem(this.hiddenElements, element);
    removeItem(this.visibleElements, element);
    removeItem(this._elementsOrderedByDisplayPriority, element);

    if (this.visibleElements.length < this.PARTICIPANT_DISPLAY_LIMIT && this.hiddenElements.length > 0) {
      var elementToShow = this.hiddenElements.pop();

      if (elementToShow) {
        this.visibleElements.push(elementToShow);
      }
    }
  };

  return HiddenTileTracker;
}();

var iconMicMuted = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgOCA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNCAwQzQuNTQ3NjggMCA1LjA0NzkzIDAuMjAwMTIxIDUuNDI5NDIgMC41MzAxNDNMMS45ODE4NCAzLjk3NzcyQzEuODg1OTcgMy43MzY3NCAxLjgzMzMzIDMuNDc0NDIgMS44MzMzMyAzLjJWMi4xMzMzM0MxLjgzMzMzIDAuOTU1MiAyLjgwMzQ2IDAgNCAwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTEgMy40NDQ0NEMxIDMuODc0NzggMS4xMTQ2OCA0LjI4MTMxIDEuMzE4MzUgNC42NDEyMUwwLjYxNzAzNCA1LjM0MjUyQzAuMjI2MjE5IDQuNzkzMzEgMCA0LjE0MjM2IDAgMy40NDQ0NEMwIDMuMTk4OTggMC4yMjM4NTggMyAwLjUgM0MwLjc3NjE0MiAzIDEgMy4xOTg5OCAxIDMuNDQ0NDRaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMi4xMjIzNyA2LjU4NDczQzIuNTQyNTUgNi43ODM2NSAzLjAwNzM2IDYuOTE3ODkgMy41IDYuOTcyNDlWOEg0LjVWNi45NzI0OUM2LjQ3MzE2IDYuNzUzNzggOCA1LjI1NzYxIDggMy40NDQ0NEM4IDMuMTk4OTggNy43NzYxNCAzIDcuNSAzQzcuMjIzODYgMyA3IDMuMTk4OTggNyAzLjQ0NDQ0QzcgNC45MTcyMSA1LjY1Njg2IDYuMTExMTEgNCA2LjExMTExQzMuNTc4MzMgNi4xMTExMSAzLjE3Njk3IDYuMDMzNzggMi44MTI5MSA1Ljg5NDJMMy40NDQ1NCA1LjI2MjU3QzMuNjIxODEgNS4zMDg3NCAzLjgwNzk5IDUuMzMzMzMgNCA1LjMzMzMzQzUuMTk2NTQgNS4zMzMzMyA2LjE2NjY3IDQuMzc4MTMgNi4xNjY2NyAzLjJWMi41NDA0NEw3Ljg1MzU1IDAuODUzNTUzQzguMDQ4ODIgMC42NTgyOTEgOC4wNDg4MiAwLjM0MTcwOSA3Ljg1MzU1IDAuMTQ2NDQ3QzcuNjU4MjkgLTAuMDQ4ODE1NSA3LjM0MTcxIC0wLjA0ODgxNTUgNy4xNDY0NSAwLjE0NjQ0N0wwLjE0NjQ0NyA3LjE0NjQ1Qy0wLjA0ODgxNTUgNy4zNDE3MSAtMC4wNDg4MTU1IDcuNjU4MjkgMC4xNDY0NDcgNy44NTM1NUMwLjM0MTcwOSA4LjA0ODgxIDAuNjU4MjkxIDguMDQ4ODEgMC44NTM1NTMgNy44NTM1NUwyLjEyMjM3IDYuNTg0NzNaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=';

var iconMicEnabled = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgOCA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMS44MzMzMyAzLjJDMS44MzMzMyA0LjM3ODEzIDIuODAzNDYgNS4zMzMzMyA0IDUuMzMzMzNDNS4xOTY1NCA1LjMzMzMzIDYuMTY2NjcgNC4zNzgxMyA2LjE2NjY3IDMuMlYyLjEzMzMzQzYuMTY2NjcgMC45NTUyIDUuMTk2NTQgMCA0IDBDMi44MDM0NiAwIDEuODMzMzMgMC45NTUyIDEuODMzMzMgMi4xMzMzM1YzLjJaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMSAzLjQ0NDQ0QzEgMy4xOTg5OCAwLjc3NjE0MiAzIDAuNSAzQzAuMjIzODU4IDMgMCAzLjE5ODk4IDAgMy40NDQ0NEMwIDUuMjU3NjEgMS41MjY4NCA2Ljc1Mzc4IDMuNSA2Ljk3MjQ5VjhINC41VjYuOTcyNDlDNi40NzMxNiA2Ljc1Mzc4IDggNS4yNTc2MSA4IDMuNDQ0NDRDOCAzLjE5ODk4IDcuNzc2MTQgMyA3LjUgM0M3LjIyMzg2IDMgNyAzLjE5ODk4IDcgMy40NDQ0NEM3IDQuOTE3MjEgNS42NTY4NiA2LjExMTExIDQgNi4xMTExMUMyLjM0MzE0IDYuMTExMTEgMSA0LjkxNzIxIDEgMy40NDQ0NFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==';

var iconAudioMuted = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgOCA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNi41IDEuNTAwMUM1LjEgMS41MDAxIDQgMi42MDAxIDQgNC4wMDAwOUM0IDUuNDAwMDkgNS4xIDYuNTAwMDkgNi41IDYuNTAwMDlWNy41MDAwOUM2LjUgNy45MDAwOSA2LjA1IDguMTAwMDkgNS43IDcuOTAwMDlMMi44NSA2LjAwMDA5SDAuNUMwLjIgNi4wMDAwOSAwIDUuODAwMDkgMCA1LjUwMDA5VjIuNTAwMUMwIDIuMjAwMDkgMC4yIDIuMDAwMSAwLjUgMi4wMDAxSDIuODVMNS43IDAuMTAwMDk1QzYuMDUgLTAuMTQ5OTA1IDYuNSAwLjEwMDA5NSA2LjUgMC41MDAwOTVWMS41MDAxWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTYuNDk5OTggMy4yOTI4OUw3LjIwNzA5IDIuNTg1NzlMNy45MTQyIDMuMjkyODlMNy4yMDcwOSA0TDcuOTE0MiA0LjcwNzExTDcuMjA3MDkgNS40MTQyMUw2LjQ5OTk4IDQuNzA3MTFMNS43OTI4OCA1LjQxNDIxTDUuMDg1NzcgNC43MDcxMUw1Ljc5Mjg4IDRMNS4wODU3NyAzLjI5Mjg5TDUuNzkyODggMi41ODU3OUw2LjQ5OTk4IDMuMjkyODlaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=';

var iconAudioEnabled = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgNiA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNS41IDAuNTAwMDk1QzUuNSAwLjEwMDA5NSA1LjA1IC0wLjE0OTkwNSA0LjcgMC4xMDAwOTVMMS44NSAyLjAwMDFIMC41QzAuMiAyLjAwMDEgMCAyLjIwMDEgMCAyLjUwMDFWNS41MDAwOUMwIDUuODAwMSAwLjIgNi4wMDAwOSAwLjUgNi4wMDAwOUgxLjg1TDQuNyA3LjkwMDA5QzUuMDUgOC4xMDAwOSA1LjUgNy45MDAwOSA1LjUgNy41MDAwOVYwLjUwMDA5NVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==';

var classes = /*#__PURE__*/createStyles({
  audioButton: {
    position: 'absolute',
    left: 12,
    bottom: 12,
    height: 24,
    width: 24,
    background: 'rgba(0, 0, 0, 0.5)',
    backdropFilter: 'blur(15px)',
    borderRadius: 6,
    opacity: 0,
    'transition-property': 'opacity',
    'transition-duration': '0.5s',
    'transition-timing-function': 'ease-in',
    '&:hover': {
      background: '#000000'
    },
    '&.audio-disabled': {
      background: '#E61D1D',
      opacity: 1
    },
    '&:hover.audio-disabled': {
      background: '#9F0202'
    },
    '&.audio-enabled .icon-disabled': {
      display: 'none'
    },
    '&.audio-disabled .icon-enabled': {
      display: 'none'
    },
    '&.subscriber-audio-button': {
      display: 'none'
    }
  },
  icon: {
    height: 12,
    width: 12
  }
});

var createSvgIcon = function createSvgIcon(svgSrc) {
  var _icon$classList;

  var icon = document.createElement('img');
  icon.src = svgSrc;

  for (var _len = arguments.length, otherClasses = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    otherClasses[_key - 1] = arguments[_key];
  }

  (_icon$classList = icon.classList).add.apply(_icon$classList, [classes.icon].concat(otherClasses));

  return icon;
};

var createAudioToggleButton = function createAudioToggleButton(_ref) {
  var isAudioEnabled = _ref.isAudioEnabled,
      enabledIcon = _ref.enabledIcon,
      disabledIcon = _ref.disabledIcon,
      type = _ref.type;
  var button = document.createElement('button');
  button.classList.add(classes.audioButton, 'video-audio-button', type === 'publisher' ? 'publisher-audio-button' : 'subscriber-audio-button');
  button.appendChild(enabledIcon);
  button.appendChild(disabledIcon);

  if (isAudioEnabled) {
    button.classList.add('audio-enabled');
  } else {
    button.classList.add('audio-disabled');
  }

  return {
    element: button,
    setEnabled: function setEnabled() {
      button.classList.remove('audio-disabled');
      button.classList.add('audio-enabled');
    },
    setDisabled: function setDisabled() {
      button.classList.remove('audio-enabled');
      button.classList.add('audio-disabled');
    }
  };
};

var createPublisherAudioToggleButton = function createPublisherAudioToggleButton(isAudioEnabled) {
  var disabledIcon = createSvgIcon(iconMicMuted, 'icon-disabled');
  var enabledIcon = createSvgIcon(iconMicEnabled, 'icon-enabled');
  return createAudioToggleButton({
    isAudioEnabled: isAudioEnabled,
    enabledIcon: enabledIcon,
    disabledIcon: disabledIcon,
    type: 'publisher'
  });
};
var createSubscriberAudioToggleButton = function createSubscriberAudioToggleButton(isAudioEnabled) {
  var disabledIcon = createSvgIcon(iconAudioMuted, 'icon-disabled');
  var enabledIcon = createSvgIcon(iconAudioEnabled, 'icon-enabled');
  return createAudioToggleButton({
    isAudioEnabled: isAudioEnabled,
    enabledIcon: enabledIcon,
    disabledIcon: disabledIcon,
    type: 'subscriber'
  });
};

var classes$1 = /*#__PURE__*/createStyles({
  name: {
    background: 'rgba(0, 0, 0, 0.5)',
    backdropFilter: 'blur(15px)',
    borderRadius: '6px',
    paddingLeft: '8px',
    paddingRight: '8px',
    textAlign: 'center',
    fontSize: '14px',
    fontStyle: 'normal',
    lineHeight: '24px',
    whiteSpace: 'nowrap',
    overflow: 'hidden',
    textOverflow: 'ellipsis',
    maxWidth: '80%',
    marginLeft: '12px'
  }
});
var createNameDisplay = function createNameDisplay(name) {
  var div = document.createElement('div');
  div.innerText = name;
  div.classList.add(classes$1.name, 'participant-name');
  return div;
};

var iconNetworkQualityPoor = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOSIgaGVpZ2h0PSI2IiB2aWV3Qm94PSIwIDAgOSA2IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMC43MDk5NjEgMS43ODgxNEMxLjgwMzcxIDAuODYzOTczIDMuMTk1NzYgMC4zNzk4ODMgNC42ODcyMyAwLjM3OTg4M0M2LjE3ODcxIDAuMzc5ODgzIDcuNTcwNzYgMC44NjM5NzMgOC42NjQ1MSAxLjc4ODE0TDcuOTY4NDkgMi40NDgyN0M3LjA3MzYgMS42NTYxMiA1LjkzMDEzIDEuMjYwMDUgNC42ODcyMyAxLjI2MDA1QzMuNDQ0MzQgMS4yNjAwNSAyLjMwMDg3IDEuNjU2MTIgMS40MDU5OCAyLjQwNDI2TDAuNzA5OTYxIDEuNzg4MTRaIiBmaWxsPSIjRTYxRDFEIi8+CjxwYXRoIGQ9Ik02LjQyNzM0IDMuOTAwNTRDNS45Nzk5IDMuNDYwNDYgNS4zMzM1OSAzLjI0MDQyIDQuNjg3MjggMy4yNDA0MkM0LjA0MDk4IDMuMjQwNDIgMy4zOTQ2NyAzLjQ2MDQ2IDIuOTQ3MjMgMy45MDA1NEwyLjI1MTIgMy4yODQ0MkMyLjg5NzUxIDIuNjY4MzEgMy43NDI2OCAyLjM2MDI1IDQuNjg3MjggMi4zNjAyNUM1LjYzMTg5IDIuMzYwMjUgNi40NzcwNiAyLjY2ODMxIDcuMTIzMzYgMy4yODQ0Mkw2LjQyNzM0IDMuOTAwNTRaIiBmaWxsPSIjRTYxRDFEIi8+CjxwYXRoIGQ9Ik00LjY4NzIzIDUuNjYwODdDNS4wOTkwOSA1LjY2MDg3IDUuNDMyOTcgNS4zNjUzMiA1LjQzMjk3IDUuMDAwNzRDNS40MzI5NyA0LjYzNjE3IDUuMDk5MDkgNC4zNDA2MiA0LjY4NzIzIDQuMzQwNjJDNC4yNzUzNyA0LjM0MDYyIDMuOTQxNSA0LjYzNjE3IDMuOTQxNSA1LjAwMDc0QzMuOTQxNSA1LjM2NTMyIDQuMjc1MzcgNS42NjA4NyA0LjY4NzIzIDUuNjYwODdaIiBmaWxsPSIjRTYxRDFEIi8+Cjwvc3ZnPg==';

var classes$2 = /*#__PURE__*/createStyles({
  networkQualityWarning: {
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    height: '24px',
    minWidth: '24px',
    background: 'rgba(0, 0, 0, 0.5)',
    backdropFilter: 'blur(15px)',
    borderRadius: '6px',
    opacity: 0
  },
  networkQualityIcon: {
    width: '20px',
    height: '20px'
  },
  active: {
    opacity: 1
  }
});
var createNetworkQualityWarning = function createNetworkQualityWarning() {
  var div = document.createElement('div');
  div.classList.add(classes$2.networkQualityWarning, 'network-quality-warning');
  var icon = document.createElement('img');
  icon.src = iconNetworkQualityPoor;
  icon.classList.add(classes$2.networkQualityIcon, 'network-quality-warning-icon');
  div.appendChild(icon);
  return {
    element: div,
    show: function show() {
      return div.classList.add(classes$2.active);
    },
    hide: function hide() {
      return div.classList.remove(classes$2.active);
    }
  };
};

var classes$3 = /*#__PURE__*/createStyles({
  videoOverlay: {
    position: 'relative',
    width: '100%',
    height: '100%',
    zIndex: 1,
    '&:hover .video-audio-button': {
      opacity: 1
    }
  },
  bottomRightContainer: {
    maxWidth: 'calc(100% - 68px)',
    position: 'absolute',
    bottom: 12,
    top: 'auto',
    right: 12,
    display: 'flex',
    width: '100%',
    justifyContent: 'flex-end'
  }
});

var createOverlay = function createOverlay(_ref) {
  var targetId = _ref.targetId,
      participantName = _ref.participantName,
      isAudioEnabled = _ref.isAudioEnabled,
      type = _ref.type;
  var targetVideoContainerDiv = document.getElementById(targetId);

  if (!targetVideoContainerDiv) {
    logger.warn('Target div not found when creating overlay: ', targetId);
    return;
  }

  var overlayClass;
  var overlayId;
  var audioToggleButton;

  if (type === 'publisher') {
    overlayClass = 'MP_publisher_overlay';
    overlayId = 'MP_camera_publisher_default_controls';
    audioToggleButton = createPublisherAudioToggleButton(isAudioEnabled);
  } else {
    overlayClass = 'MP_subscriber_overlay';
    overlayId = "MP_" + targetId + "_default_controls";
    audioToggleButton = createSubscriberAudioToggleButton(isAudioEnabled);
  }

  var overlayDiv = createDiv(overlayId);
  overlayDiv.classList.add(classes$3.videoOverlay, overlayClass);
  overlayDiv.appendChild(audioToggleButton.element);
  var bottomRightContainer = document.createElement('div');
  bottomRightContainer.classList.add(classes$3.bottomRightContainer);
  var networkQualityWarning = createNetworkQualityWarning();
  bottomRightContainer.appendChild(networkQualityWarning.element);

  if (participantName) {
    var nameElement = createNameDisplay(participantName);
    bottomRightContainer.appendChild(nameElement);
  }

  overlayDiv.appendChild(bottomRightContainer);
  targetVideoContainerDiv.appendChild(overlayDiv);
  var overlay = Object.assign(new events.EventEmitter(), {
    setAudioEnabled: audioToggleButton.setEnabled,
    setAudioDisabled: audioToggleButton.setDisabled,
    showNetworkQualityWarning: networkQualityWarning.show,
    hideNetworkQualityWarning: networkQualityWarning.hide
  });
  audioToggleButton.element.addEventListener('click', function () {
    overlay.emit('toggleAudioClicked');
  });
  return overlay;
};

var createPublisherOverlay = function createPublisherOverlay(_ref2) {
  var id = _ref2.id,
      isAudioEnabled = _ref2.isAudioEnabled,
      participantName = _ref2.participantName;
  return createOverlay({
    targetId: id,
    isAudioEnabled: isAudioEnabled,
    participantName: participantName,
    type: 'publisher'
  });
};
var createSubscriberOverlay = function createSubscriberOverlay(_ref3) {
  var id = _ref3.id,
      participantName = _ref3.participantName;
  return createOverlay({
    targetId: id,
    isAudioEnabled: true,
    participantName: participantName,
    type: 'subscriber'
  });
};

var Subscriber = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(Subscriber, _EventEmitter);

  function Subscriber(otSubscriber) {
    var _this;

    _this = _EventEmitter.call(this) || this;

    _this._toggleAudioEnabled = function () {
      if (_this._subscribingToAudio) {
        _this.disableAudio();
      } else {
        _this.enableAudio();
      }
    };

    _this.getSubscriberElement = function () {
      var _this$otSubscriber;

      return (_this$otSubscriber = _this.otSubscriber) == null ? void 0 : _this$otSubscriber.element;
    };

    _this.isVideoEnabled = function () {
      var _this$otSubscriber2, _this$otSubscriber2$s;

      return !!((_this$otSubscriber2 = _this.otSubscriber) != null && (_this$otSubscriber2$s = _this$otSubscriber2.stream) != null && _this$otSubscriber2$s.hasVideo);
    };

    _this.isAudioEnabled = function () {
      var _this$otSubscriber3, _this$otSubscriber3$s;

      return !!((_this$otSubscriber3 = _this.otSubscriber) != null && (_this$otSubscriber3$s = _this$otSubscriber3.stream) != null && _this$otSubscriber3$s.hasAudio);
    };

    _this._setSubscribeToVideo = function (shouldSubscribe) {
      var _this$otSubscriber4;

      return (_this$otSubscriber4 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber4.subscribeToVideo(shouldSubscribe);
    };

    _this.enableVideo = function () {
      var _this$otSubscriber5;

      (_this$otSubscriber5 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber5.subscribeToVideo(true);
    };

    _this.disableVideo = function () {
      var _this$otSubscriber6;

      return (_this$otSubscriber6 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber6.subscribeToVideo(false);
    };

    _this.enableAudio = function () {
      var _this$otSubscriber7, _this$overlay;

      (_this$otSubscriber7 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber7.subscribeToAudio(true);
      _this._subscribingToAudio = true;
      (_this$overlay = _this.overlay) == null ? void 0 : _this$overlay.setAudioEnabled();
    };

    _this.disableAudio = function () {
      var _this$otSubscriber8, _this$overlay2;

      (_this$otSubscriber8 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber8.subscribeToAudio(false);
      _this._subscribingToAudio = false;
      (_this$overlay2 = _this.overlay) == null ? void 0 : _this$overlay2.setAudioDisabled();
    };

    _this.setDisabledImageURI = function (imageURI) {
      var _this$otSubscriber9;

      (_this$otSubscriber9 = _this.otSubscriber) == null ? void 0 : _this$otSubscriber9.setStyle('backgroundImageURI', imageURI);
    };

    _this.otSubscriber = otSubscriber;
    _this.id = otSubscriber.id;
    _this._subscribingToAudio = true;

    var _onAudioLevelUpdated = function _onAudioLevelUpdated(event) {
      _this.emit('audioLevelUpdated', event.audioLevel);
    };

    var audioLevelUpdatedHandler = lodash.throttle(_onAudioLevelUpdated, 60, {
      // So we don't send events after stream is destroyed
      leading: true,
      trailing: false
    });

    _this.otSubscriber.on('audioLevelUpdated', audioLevelUpdatedHandler);

    _this.otSubscriber.on('destroyed', function () {
      return _this.emit('destroyed');
    });

    _this.otSubscriber.on('videoElementCreated', function () {
      var _this$otSubscriber10, _this$otSubscriber10$;

      if (((_this$otSubscriber10 = _this.otSubscriber) == null ? void 0 : (_this$otSubscriber10$ = _this$otSubscriber10.stream) == null ? void 0 : _this$otSubscriber10$.videoType) !== 'screen') {
        if (_this.id) {
          var _this$otSubscriber$st, _this$otSubscriber$st2, _this$overlay3;

          _this.overlay = createSubscriberOverlay({
            id: _this.id,
            participantName: (_this$otSubscriber$st = (_this$otSubscriber$st2 = _this.otSubscriber.stream) == null ? void 0 : _this$otSubscriber$st2.name) != null ? _this$otSubscriber$st : ''
          });
          (_this$overlay3 = _this.overlay) == null ? void 0 : _this$overlay3.on('toggleAudioClicked', function () {
            _this._toggleAudioEnabled();
          });
        } else {
          logger.warn('Subscriber id undefined when trying to create overlay');
        }
      }

      _this.emit('videoElementCreated');
    });

    _this.otSubscriber.on('videoDisableWarning', function () {
      var _this$overlay4;

      return (_this$overlay4 = _this.overlay) == null ? void 0 : _this$overlay4.showNetworkQualityWarning();
    });

    _this.otSubscriber.on('videoDisableWarningLifted', function () {
      var _this$overlay5;

      return (_this$overlay5 = _this.overlay) == null ? void 0 : _this$overlay5.hideNetworkQualityWarning();
    });

    _this.otSubscriber.on('videoDisabled', function (_ref) {
      var reason = _ref.reason;

      if (reason === 'quality') {
        var _this$overlay6;

        (_this$overlay6 = _this.overlay) == null ? void 0 : _this$overlay6.showNetworkQualityWarning();
      }
    });

    _this.otSubscriber.on('videoEnabled', function (_ref2) {
      var reason = _ref2.reason;

      if (reason === 'quality') {
        var _this$overlay7;

        (_this$overlay7 = _this.overlay) == null ? void 0 : _this$overlay7.hideNetworkQualityWarning();
      }
    });

    return _this;
  }

  return Subscriber;
}(events.EventEmitter);

var proxyUrl;
var ConfigStore = {
  setProxyUrl: function setProxyUrl(url) {
    proxyUrl = url;
  },
  getProxyUrl: function getProxyUrl() {
    return proxyUrl;
  }
};

/** Analytics */

var logVariation = {
  attempt: 'Attempt',
  success: 'Success',
  failure: 'Failure'
};
var logAction = {
  // vars for the analytics logs. Internal use
  initRoom: 'InitRoom',
  joinRoom: 'JoinRoom',
  leaveRoom: 'LeaveRoom',
  startScreenSharing: 'StartScreenSharing',
  stopScreenSharing: 'StopScreenSharing',
  publishCameraPublisher: 'PublishCameraPublisher',
  destroyCameraPublisher: 'DestroyCameraPublisher',
  cameraPublisherEnableVideo: 'CameraPublisherEnableVideo',
  cameraPublisherEnableAudio: 'CameraPublisherEnableAudio',
  cameraPublisherDisableVideo: 'CameraPublisherDisableVideo',
  cameraPublisherDisableAudio: 'CameraPublisherDisableAudio',
  screenPublisherEnableVideo: 'ScreenPublisherEnableVideo',
  screenPublisherEnableAudio: 'ScreenPublisherEnableAudio',
  screenPublisherDisableVideo: 'ScreenPublisherDisableVideo',
  screenPublisherDisableAudio: 'ScreenPublisherDisableAudio',
  cameraSubscriberEnableVideo: 'CameraSubscriberEnableVideo',
  cameraSubscriberEnableAudio: 'CameraSubscriberEnableAudio',
  cameraSubscriberDisableVideo: 'CameraSubscriberDisableVideo',
  cameraSubscriberDisableAudio: 'CameraSubscriberDisableAudio',
  screenSubscriberEnableVideo: 'ScreenSubscriberEnableVideo',
  screenSubscriberEnableAudio: 'ScreenSubscriberEnableAudio',
  screenSubscriberDisableVideo: 'ScreenSubscriberDisableVideo',
  screenSubscriberDisableAudio: 'ScreenSubscriberDisableAudio',
  initPreviewPublisher: 'InitPreviewPublisher',
  destroyPreviewPublisher: 'DestroyPreviewPublisher',
  previewPublisherEnableVideo: 'PreviewPublisherEnableVideo',
  previewPublisherEnableAudio: 'PreviewPublisherEnableAudio',
  previewPublisherDisableVideo: 'PreviewPublisherDisableVideo',
  previewPublisherDisableAudio: 'PreviewPublisherDisableAudio',
  setVideoDevice: 'SetVideoDevice',
  setAudioDevice: 'SetAudioDevice',
  getAudioOutputDevices: 'GetAudioOutputDevices',
  getActiveAudioOutputDevice: 'GetActiveAudioOutputDevice',
  getVideoDevice: 'GetVideoDevice',
  getAudioDevice: 'GetAudioDevice',
  getDevices: 'GetDevices',
  createCameraSubscriber: 'CreateCameraSubscriber',
  createScreenSubscriber: 'CreateScreenSubscriber',
  setProxyUrl: 'SetProxyUrl',
  setAudioOutputDevice: 'SetAudioOutputDevice',
  setVideoFilter: 'SetVideoFilter',
  clearVideoFilter: 'ClearVideoFilter'
};
var defaultProps = {
  source: window.location.origin
};

var Analytics = function Analytics(analyticsProps) {
  var _this = this;

  if (analyticsProps === void 0) {
    analyticsProps = defaultProps;
  }

  this.update = function (sessionId, connectionId, apiKey) {
    if (sessionId && connectionId && apiKey) {
      var sessionInfo = {
        sessionId: sessionId,
        connectionId: connectionId,
        partnerId: apiKey
      };

      _this.analytics.addSessionInfo(sessionInfo);
    }
  };

  this.log = function (action, variation, payload) {

    var data = {
      action: action,
      variation: variation
    };

    if (payload) {
      data.payload = payload;
    }

    _this.analytics.logEvent(data);
  };

  var _analyticsProps = analyticsProps,
      _analyticsProps$sourc = _analyticsProps.source,
      source = _analyticsProps$sourc === void 0 ? window.location.origin : _analyticsProps$sourc,
      sessionId = _analyticsProps.sessionId,
      connectionId = _analyticsProps.connectionId,
      apiKey = _analyticsProps.apiKey;
  var otkanalyticsData = {
    clientVersion: "video-express-1.4.2" ,
    source: source,
    componentId: 'video-express',
    name: 'video-express',
    partnerId: apiKey,
    sessionId: sessionId
  };
  var options = {};
  var proxyUrl = ConfigStore.getProxyUrl(); // Make sure to proxy VE-specific logs too

  if (proxyUrl) {
    options.proxyUrl = proxyUrl;
  }

  this.analytics = new OTKAnalytics(otkanalyticsData, options);

  if (sessionId && connectionId && apiKey) {
    this.update(sessionId, connectionId, apiKey);
  }
};

var data = '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';
var smileIconDataURI = "data:image/png;base64," + data;

var classes$4 = /*#__PURE__*/createStyles({
  subscriberOnLoad: {
    display: ['none', '!important']
  }
});

var CameraSubscriber = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(CameraSubscriber, _EventEmitter);

  function CameraSubscriber(stream, otSubscriber, analytics) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this._stream = stream;
    _this.movingAvg = null;

    var _subscriber = new Subscriber(otSubscriber);

    _this.id = _subscriber.id;

    _subscriber.on('audioLevelUpdated', function (audioLevel) {
      if (_this.movingAvg === null || _this.movingAvg <= audioLevel) {
        _this.movingAvg = audioLevel;
      } else {
        _this.movingAvg = 0.7 * _this.movingAvg + 0.3 * audioLevel;
      } // 1.5 scaling to map the -30 - 0 dBm range to [0,1]


      var logLevel = Math.log(_this.movingAvg) / Math.LN10 / 1.5 + 1;
      logLevel = Math.min(Math.max(logLevel, 0), 1);

      _this.emit('audioLevelUpdated', audioLevel, logLevel);
    });

    _subscriber.on('destroyed', function () {
      _this.emit('destroyed');
    });

    _subscriber.on('videoElementCreated', function () {
      _this.emit('created');
    });

    _this.setOptimalPreferredResolution = function () {
      if (_subscriber) {
        var _otSubscriber2$elemen, _otSubscriber2$elemen2;

        var _otSubscriber2 = _subscriber.otSubscriber;
        var videoElementWidth = (_otSubscriber2$elemen = _otSubscriber2.element) == null ? void 0 : _otSubscriber2$elemen.offsetWidth;
        var videoElementHeight = (_otSubscriber2$elemen2 = _otSubscriber2.element) == null ? void 0 : _otSubscriber2$elemen2.offsetHeight;

        if (videoElementWidth && videoElementHeight) {
          var preferredResolution = {
            width: videoElementWidth * window.devicePixelRatio,
            height: videoElementHeight * window.devicePixelRatio
          };

          _otSubscriber2.setPreferredResolution(preferredResolution);
        }
      }
    };

    _this.getSubscriberElement = function () {
      return _subscriber == null ? void 0 : _subscriber.getSubscriberElement();
    };

    _this.isVideoEnabled = function () {
      return _subscriber == null ? void 0 : _subscriber.isVideoEnabled();
    };

    _this.isAudioEnabled = function () {
      return _subscriber == null ? void 0 : _subscriber.isAudioEnabled();
    };

    _this.enableVideo = function () {
      analytics.log(logAction.cameraSubscriberEnableVideo, logVariation.attempt);

      if (_subscriber) {
        _subscriber.enableVideo();

        logger.debug('Enabled subscriber video: ', _this.id);
        analytics.log(logAction.cameraSubscriberEnableVideo, logVariation.success);
      } else {
        analytics.log(logAction.cameraSubscriberEnableVideo, logVariation.failure);
      }
    };

    _this.disableVideo = function () {
      analytics.log(logAction.cameraSubscriberDisableVideo, logVariation.attempt);

      if (_subscriber) {
        _subscriber.disableVideo();

        logger.debug('Disabled subscriber video: ', _this.id);
        analytics.log(logAction.cameraSubscriberDisableVideo, logVariation.success);
      } else {
        analytics.log(logAction.cameraSubscriberDisableVideo, logVariation.failure);
      }
    };

    _this.enableAudio = function () {
      analytics.log(logAction.cameraSubscriberEnableAudio, logVariation.attempt);

      if (_subscriber) {
        _subscriber.enableAudio();

        analytics.log(logAction.cameraSubscriberEnableAudio, logVariation.success);
      } else {
        analytics.log(logAction.cameraSubscriberEnableAudio, logVariation.failure);
      }
    };

    _this.disableAudio = function () {
      analytics.log(logAction.cameraSubscriberDisableAudio, logVariation.attempt);

      if (_subscriber) {
        _subscriber.disableAudio();

        analytics.log(logAction.cameraSubscriberDisableAudio, logVariation.success);
      } else {
        analytics.log(logAction.cameraSubscriberDisableAudio, logVariation.failure);
      }
    };

    _this.setDisabledImageURI = function (imageURI) {
      _subscriber.setDisabledImageURI(imageURI);
    };

    return _this;
  }

  return CameraSubscriber;
}(events.EventEmitter);
/* We can't use a promise here because the videoElementCreated event may be fired between
 * calling resolve() and the success handler being executed. Instead we use a synchronous callback.
 */

var createCameraSubscriber = function createCameraSubscriber(session, stream, shouldEnableVideo, analytics, callback) {
  var _otSubscriber = session.subscribe(stream, 'layoutContainer', {
    insertMode: 'append',
    subscribeToVideo: shouldEnableVideo,
    style: {
      buttonDisplayMode: 'off',
      nameDisplayMode: 'off',
      videoDisabledDisplayMode: 'off',
      backgroundImageURI: smileIconDataURI
    }
  }, function (error) {
    analytics.log(logAction.createCameraSubscriber, logVariation.attempt);

    if (error) {
      analytics.log(logAction.createCameraSubscriber, logVariation.failure, {
        error: error
      });
      callback(error);
    } else {
      var cameraSubscriber = new CameraSubscriber(stream, _otSubscriber, analytics);
      callback(undefined, cameraSubscriber);
      analytics.log(logAction.createCameraSubscriber, logVariation.success);
    }
  });

  if (_otSubscriber.element instanceof HTMLElement) {
    var _otSubscriber$element;

    // hide loading subscriber videos until ready to be displayed by layout manager
    (_otSubscriber$element = _otSubscriber.element) == null ? void 0 : _otSubscriber$element.classList.add(classes$4.subscriberOnLoad);
  }
};

var LARGE_CLASS_NAME = 'OT_big';
var DEFAULT_MOBILE_PARTICIPANTS = 3;
var DEFAULT_DESKTOP_PARTICIPANTS = 25;
var ACTIVE_SPEAKER_HIGHLIGHT_CLASS = 'active_speaker_highlight';
var DEFAULT_ACTIVE_SPEAKER_COLOR = '#53CA6A';
var defaultLayoutOptions = {
  fixedRatio: false,
  alignItems: 'center',
  bigPercentage: 0.8,
  bigFixedRatio: false,
  bigAlignItems: 'center',
  smallAlignItems: 'center',
  maxWidth: Infinity,
  maxHeight: Infinity,
  smallMaxWidth: Infinity,
  smallMaxHeight: Infinity,
  bigMaxWidth: Infinity,
  bigMaxHeight: Infinity,
  bigMaxRatio: 3 / 2,
  bigMinRatio: 9 / 16,
  bigFirst: true
};
var fixedLayoutOptions = {
  bigClass: LARGE_CLASS_NAME,
  window: window,
  animate: false,
  ignoreClass: 'OT_ignore'
};

var getClasses = function getClasses(speakerHighlightColor) {
  var _layoutContainer;

  var outerMargin = 8;
  var marginOffset = 2 * outerMargin; // i.e. marginTop + marginBottom or marginLeft + marginRight

  return createStyles({
    layoutContainer: (_layoutContainer = {
      margin: outerMargin,
      width: "calc(100% - " + marginOffset + "px)",
      height: "calc(100% - " + marginOffset + "px)",
      position: 'relative',
      '& > *': {
        width: 0,
        height: 0,
        opacity: 0
      },
      '& > .ot-layout': {
        opacity: 1
      },
      '& > .OT_publisher, & > .OT_subscriber': {
        margin: 4,
        borderRadius: 16,
        // Fix for safari border radius https://stackoverflow.com/a/16681137/5433407
        '-webkit-backface-visibility': 'hidden',
        '-webkit-transform': 'translate3d(0, 0, 0)'
      },
      '& > .OT_subscriber.MP_screenshare_subscriber': {
        borderRadius: 0
      }
    }, _layoutContainer["& > .OT_subscriber." + ACTIVE_SPEAKER_HIGHLIGHT_CLASS] = {
      borderColor: "" + (speakerHighlightColor || DEFAULT_ACTIVE_SPEAKER_COLOR),
      borderWidth: "3px",
      borderStyle: "solid"
    }, _layoutContainer),
    layoutContainerWrapper: {
      width: '100%',
      height: '100%',
      overflow: 'auto'
    }
  });
};

var LayoutManager = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(LayoutManager, _EventEmitter);

  function LayoutManager(targetElement, layoutOptions, maxVideoParticipantsOnScreen) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this._screenSharingElementIds = [];
    _this._cameraSubscriberElementIds = [];
    _this._layoutMode = 'grid';
    _this.isViewingScreenshare = false;

    _this._initLayoutContainerElement = function (roomContainerElement) {
      var roomContainer = getTargetElementFromDOM(roomContainerElement);
      var layoutContainerElement = createDiv('layoutContainer');
      var layoutContainerWrapperElement = createDiv('layoutContainerWrapper');
      var classes = getClasses(_this._speakerHighlightColor);
      layoutContainerElement.classList.add(classes.layoutContainer);
      layoutContainerWrapperElement.classList.add(classes.layoutContainerWrapper);
      layoutContainerWrapperElement.appendChild(layoutContainerElement);
      roomContainer.appendChild(layoutContainerWrapperElement);
      return layoutContainerElement;
    };

    _this._initContainerResizeListener = function () {
      var throttledRecalculateLayout = lodash.throttle(function () {
        return _this._recalculateTileSizes();
      }, 20);
      var resizeObserver = new ResizeObserverPolyfill(function () {
        throttledRecalculateLayout();
      });
      resizeObserver.observe(_this._layoutContainerElement);
    };

    _this.setLayoutMode = function (layoutMode) {
      _this._layoutMode = layoutMode;

      _this.updateLayout();
    };

    _this._setElementBig = function (element) {
      element.classList.add(LARGE_CLASS_NAME);
    };

    _this._setElementSmall = function (element) {
      element.classList.remove(LARGE_CLASS_NAME);
    };

    _this._hideElement = function (element) {
      var currentStyle = getComputedStyle(element);

      if (currentStyle.display !== 'none') {
        element.style.display = 'none';

        if (_this._cameraSubscriberElementIds.includes(element.id)) {
          _this.emit('cameraSubscriberHidden', element.id);
        }
      }
    };

    _this._displayElement = function (element) {
      var currentStyle = getComputedStyle(element);

      if (currentStyle.display !== 'block') {
        element.style.display = 'block';

        if (_this._cameraSubscriberElementIds.includes(element.id)) {
          _this.emit('cameraSubscriberDisplayed', element.id);
        }
      }
    };

    _this._removeSubscriberOnLoad = function (element) {
      element.classList.remove(classes$4.subscriberOnLoad);
    };

    _this._setAllElementsSmall = function () {
      _this._layoutContainerElement.childNodes.forEach(function (node) {
        if (node instanceof HTMLElement) {
          _this._setElementSmall(node);
        }
      });
    };

    _this._setOnlyScreenElementsBig = function () {
      _this._layoutContainerElement.childNodes.forEach(function (node) {
        if (!(node instanceof HTMLElement)) {
          return;
        }

        if (!_this._screenSharingElementIds.includes(node.id)) {
          _this._setElementSmall(node);
        } else {
          _this._setElementBig(node);
        }
      });
    };

    _this._setOnlyActiveSpeakerElementBig = function () {
      var elementToSetBig = _this._getActiveSpeakerViewLargeElement();

      _this._setAllElementsSmall();

      if (elementToSetBig) {
        _this._setElementBig(elementToSetBig);
      }
    };

    _this._getActiveSpeakerViewLargeElement = function () {
      if (_this._activeSpeakerElement) {
        return _this._activeSpeakerElement;
      }

      var subscriber = _this._layoutContainerElement.querySelector('.OT_subscriber');

      if (subscriber) {
        return subscriber;
      }

      var publisher = _this._layoutContainerElement.querySelector('.OT_publisher');

      if (publisher) {
        return publisher;
      }

      logger.error('No publisher or subscriber elements found when setting active speaker layout');
      return;
    };

    _this._displayOnlyScreenElement = function () {
      _this._layoutContainerElement.childNodes.forEach(function (node) {
        if (!(node instanceof HTMLElement)) {
          return;
        }

        if (!_this._screenSharingElementIds.includes(node.id)) {
          _this._hideElement(node);
        } else {
          _this._setElementBig(node);
        }
      });
    };

    _this._displayOnlyActiveSpeaker = function () {
      var elementToSetBig = _this._getActiveSpeakerViewLargeElement();

      _this._layoutContainerElement.childNodes.forEach(function (node) {
        if (!(node instanceof HTMLElement)) {
          return;
        } else if (node !== elementToSetBig) {
          _this._hideElement(node);
        } else {
          _this._displayElement(node);
        }
      });
    };

    _this._displayLimitedGridElements = function () {
      _this._layoutContainerElement.childNodes.forEach(function (node) {
        var _this$_hiddenTileTrac;

        if (!(node instanceof HTMLElement)) {
          return;
        } else if ((_this$_hiddenTileTrac = _this._hiddenTileTracker) != null && _this$_hiddenTileTrac.hiddenElements.includes(node)) {
          _this._hideElement(node);
        } else {
          _this._displayElement(node);
        }
      });
    };

    _this._isSubscribingToScreen = function () {
      return _this._screenSharingElementIds.length > 0;
    };

    _this.onScreenSubscriberCreated = function (subscriberId) {
      if (subscriberId) {
        _this._screenSharingElementIds.push(subscriberId);

        _this.isViewingScreenshare = true;
      }

      _this.updateLayout();
    };

    _this.onScreenSubscriberDestroyed = function (subscriberId) {
      if (subscriberId) {
        removeItem(_this._screenSharingElementIds, subscriberId);
      }

      if (_this._screenSharingElementIds.length === 0) {
        _this.isViewingScreenshare = false;
      }

      _this.updateLayout();
    };

    _this.onCameraSubscriberCreated = function (element) {
      if (element) {
        var _this$_hiddenTileTrac2;

        (_this$_hiddenTileTrac2 = _this._hiddenTileTracker) == null ? void 0 : _this$_hiddenTileTrac2.onSubscriberCreated(element);

        _this._cameraSubscriberElementIds.push(element.id);

        _this.emit('cameraSubscriberDisplayed', element.id);
      }

      _this.updateLayout();
    };

    _this.onCameraSubscriberDestroyed = function (element) {
      if (element) {
        var _this$_hiddenTileTrac3;

        (_this$_hiddenTileTrac3 = _this._hiddenTileTracker) == null ? void 0 : _this$_hiddenTileTrac3.onSubscriberRemoved(element);
        removeItem(_this._cameraSubscriberElementIds, element.id);
      }

      _this.updateLayout();
    };

    var _layoutOptions$layout = layoutOptions.layoutMode,
        layoutMode = _layoutOptions$layout === void 0 ? 'grid' : _layoutOptions$layout,
        customOTLayoutJsOptions = _objectWithoutPropertiesLoose(layoutOptions, ["layoutMode"]);

    _this._layoutMode = layoutMode;
    _this._isMobileLayout = layoutOptions.isMobileLayout;
    _this._speakerHighlightColor = layoutOptions.speakerHighlightColor;
    _this._speakerHighlightEnabled = layoutOptions.speakerHighlightEnabled;

    if (_this._speakerHighlightColor && !_this._speakerHighlightEnabled) {
      logger.warn('You passed speakerHighlightColor value without setting speakerHighlightEnabled');
    }

    var maxRatio = _this._isMobileLayout ? 16 / 9 : 14 / 16;
    var minRatio = _this._isMobileLayout ? 3 / 2 : 9 / 16;
    defaultLayoutOptions.maxRatio = maxRatio;
    defaultLayoutOptions.minRatio = minRatio;
    _this._layoutContainerElement = _this._initLayoutContainerElement(targetElement);
    _this._emitLayoutRecalculated = lodash.debounce(function () {
      _this.emit('layoutComplete');
    }, 20); // wait for CSS transition to finish before sending event. If no transition (0) then add small delay anyway

    _this._layoutContainer = initLayout(_this._layoutContainerElement, _extends({}, defaultLayoutOptions, customOTLayoutJsOptions, fixedLayoutOptions));

    _this._initContainerResizeListener(); // Max onscreen video participants: default or user-specified parameter depending on mobile/desktop layout


    if (_this._isMobileLayout) {
      _this._hiddenTileTracker = new HiddenTileTracker(DEFAULT_MOBILE_PARTICIPANTS);
    } else {
      _this._hiddenTileTracker = new HiddenTileTracker(maxVideoParticipantsOnScreen || DEFAULT_DESKTOP_PARTICIPANTS);
    }

    return _this;
  }

  var _proto = LayoutManager.prototype;

  _proto.onActiveSpeakerChanged = function onActiveSpeakerChanged(_ref) {
    var _this$_hiddenTileTrac4;

    var newActiveSpeakerElement = _ref.newActiveSpeakerElement,
        previousActiveSpeakerElement = _ref.previousActiveSpeakerElement;
    this._activeSpeakerElement = newActiveSpeakerElement; // new active speaker detected, highight them and remove the previous one

    if (this._speakerHighlightEnabled) {
      if (previousActiveSpeakerElement) {
        previousActiveSpeakerElement.classList.remove(ACTIVE_SPEAKER_HIGHLIGHT_CLASS);
      }

      if (newActiveSpeakerElement) {
        newActiveSpeakerElement.classList.add(ACTIVE_SPEAKER_HIGHLIGHT_CLASS);
      }
    }

    (_this$_hiddenTileTrac4 = this._hiddenTileTracker) == null ? void 0 : _this$_hiddenTileTrac4.onActiveSpeakerChanged(newActiveSpeakerElement);
    this.updateLayout();
  };

  _proto.onActiveSpeakerStatusChanged = function onActiveSpeakerStatusChanged(_ref2) {
    var isSpeaking = _ref2.isSpeaking;

    if (this._speakerHighlightEnabled) {
      var _this$_activeSpeakerE;

      var addOrRemoveClass = isSpeaking ? 'add' : 'remove';
      (_this$_activeSpeakerE = this._activeSpeakerElement) == null ? void 0 : _this$_activeSpeakerE.classList[addOrRemoveClass](ACTIVE_SPEAKER_HIGHLIGHT_CLASS);
    }
  };

  _proto._recalculateTileSizes = function _recalculateTileSizes() {
    this._layoutContainer.layout();

    this._emitLayoutRecalculated();
  };

  _proto.getLayoutContainerElement = function getLayoutContainerElement() {
    return this._layoutContainerElement;
  };

  _proto.updateLayout = function updateLayout() {
    if (this._isMobileLayout) {
      if (this.isViewingScreenshare) {
        this._displayOnlyScreenElement();
      } else if (this._layoutMode === 'active-speaker') {
        this._displayOnlyActiveSpeaker();
      } else {
        this._displayLimitedGridElements();
      }
    } else {
      if (this.isViewingScreenshare) {
        this._setOnlyScreenElementsBig();
      } else if (this._layoutMode === 'active-speaker') {
        this._setOnlyActiveSpeakerElementBig();
      } else {
        this._setAllElementsSmall();
      }

      this._displayLimitedGridElements();
    }

    this._recalculateTileSizes();
  };

  return LayoutManager;
}(events.EventEmitter);

var analytics = /*#__PURE__*/new Analytics();

var getDevices = function getDevices() {
  return new Promise(function (resolve, reject) {
    analytics.log(logAction.getDevices, logVariation.attempt);
    OT.getDevices(function (error, devices) {
      if (error) {
        analytics.log(logAction.getDevices, logVariation.failure, {
          error: error
        });
        reject(error);
      }

      analytics.log(logAction.getDevices, logVariation.success);
      resolve(devices);
    });
  });
};

var getDeviceIdFromSettings = function getDeviceIdFromSettings(track) {
  return track.getSettings ? track.getSettings().deviceId : '';
};

var getDeviceIdFromDevicesList = /*#__PURE__*/function () {
  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(track) {
    var devices, deviceId, currentDevice;
    return runtime_1.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            deviceId = null;
            _context.prev = 1;
            _context.next = 4;
            return getDevices();

          case 4:
            devices = _context.sent;

            if (devices && devices.length) {
              currentDevice = devices.find(function (device) {
                return device.label === track.label;
              });

              if (currentDevice) {
                deviceId = currentDevice.deviceId;
              }
            }

            _context.next = 10;
            break;

          case 8:
            _context.prev = 8;
            _context.t0 = _context["catch"](1);

          case 10:
            return _context.abrupt("return", deviceId);

          case 11:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[1, 8]]);
  }));

  return function getDeviceIdFromDevicesList(_x) {
    return _ref.apply(this, arguments);
  };
}();

var getDeviceId = /*#__PURE__*/function () {
  var _ref2 = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2(track) {
    return runtime_1.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.t1 = getDeviceIdFromSettings(track);

            if (_context2.t1) {
              _context2.next = 5;
              break;
            }

            _context2.next = 4;
            return getDeviceIdFromDevicesList(track);

          case 4:
            _context2.t1 = _context2.sent;

          case 5:
            _context2.t0 = _context2.t1;

            if (_context2.t0) {
              _context2.next = 8;
              break;
            }

            _context2.t0 = '';

          case 8:
            return _context2.abrupt("return", _context2.t0);

          case 9:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  return function getDeviceId(_x2) {
    return _ref2.apply(this, arguments);
  };
}();

var _attachEventsToOTPublisher = function _attachEventsToOTPublisher(self, publisher) {
  var _onAudioLevelUpdated = function _onAudioLevelUpdated(event) {
    self.emit('audioLevelUpdated', event.audioLevel);
  };

  var audioLevelUpdatedHandler = lodash.throttle(_onAudioLevelUpdated, 60, {
    // So we don't send events after stream is destroyed
    leading: true,
    trailing: false
  });
  publisher.on('destroyed', function () {
    return self.onDestroyed();
  });
  publisher.on('videoElementCreated', self._onVideoElementCreated);

  if (self.source === 'camera') {
    // audioLevelUpdated event will throw an exception for screen publisher,
    // if the screen being published is not a chrome tab with "share audio" selected
    // @TODO: Need to add checks for this scenario here
    publisher.on('audioLevelUpdated', audioLevelUpdatedHandler);
    publisher.on('accessAllowed', function () {
      self.emit('accessAllowed');
    });
    publisher.on('accessDenied', function () {
      self.emit('accessDenied');
    });
    publisher.on('accessDialogOpened', function () {
      self.emit('accessDialogOpened');
    });
    publisher.on('accessDialogClosed', function (reason) {
      self.emit('accessDialogClosed', reason);
    });
  }
};

var _initPublisherForCamera = function _initPublisherForCamera(targetElement, options, publisher) {
  return new Promise(function (resolve, reject) {
    var _options$style;

    var _otPublisher = OT.initPublisher(targetElement, _extends({}, options, {
      insertMode: 'append',
      style: {
        buttonDisplayMode: 'off',
        nameDisplayMode: 'off',
        backgroundImageURI: (options == null ? void 0 : (_options$style = options.style) == null ? void 0 : _options$style.backgroundImageURI) || smileIconDataURI
      }
    }), function (error) {
      if (error) {
        reject(error);
      } else {
        resolve(_otPublisher);
      }
    }); // We must attach events here. Doing so in callback or after resolving is too late


    if (_otPublisher) {
      publisher.otPublisher = _otPublisher;

      _attachEventsToOTPublisher(publisher, _otPublisher);
    }
  });
};

var _initPublisherForScreen = function _initPublisherForScreen(targetElement, options, publisher) {
  return new Promise(function (resolve, reject) {
    OT.checkScreenSharingCapability(function (response) {
      if (!response.supported || response.extensionRegistered === false) {
        reject('Screen sharing not supported for this browser');
      } else {
        var _otPublisher = OT.initPublisher(targetElement, _extends({
          videoSource: 'screen',
          insertMode: 'append',
          showControls: false,
          videoContentHint: 'detail'
        }, options), function (error) {
          if (error) {
            reject(error);
          } else {
            resolve(_otPublisher);
          }
        }); // We must attach events here. Doing so in callback or after resolving is too late


        _attachEventsToOTPublisher(publisher, _otPublisher);
      }
    });
  });
};

var Publisher = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(Publisher, _EventEmitter);

  function Publisher(source, name) {
    var _this;

    if (source === void 0) {
      source = 'camera';
    }

    _this = _EventEmitter.call(this) || this;

    _this.initOTPublisher = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(targetElement, publisherOptions) {
        var initPublisher, otPublisher;
        return runtime_1.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (_this._otPublisherPromise) {
                  _context.next = 15;
                  break;
                }

                initPublisher = _initPublisherForCamera;

                if (_this.source === 'screen') {
                  initPublisher = _initPublisherForScreen;
                }

                _this._otPublisherPromise = initPublisher(targetElement, publisherOptions, _assertThisInitialized(_this));
                _context.prev = 4;
                _context.next = 7;
                return _this._otPublisherPromise;

              case 7:
                otPublisher = _context.sent;
                _context.next = 14;
                break;

              case 10:
                _context.prev = 10;
                _context.t0 = _context["catch"](4);
                _this._otPublisherPromise = undefined;
                throw _context.t0;

              case 14:
                _this.otPublisher = otPublisher;

              case 15:
                _context.next = 17;
                return _this._otPublisherPromise;

              case 17:
                return _context.abrupt("return", _context.sent);

              case 18:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, null, [[4, 10]]);
      }));

      return function (_x, _x2) {
        return _ref.apply(this, arguments);
      };
    }();

    _this.getOTPublisher = function () {
      return _this._otPublisherPromise;
    };

    _this.onDestroyed = function () {
      logger.debug('Publisher destroyed');
      _this._otPublisherPromise = undefined;

      _this.emit('destroyed');
    };

    _this._onVideoElementCreated = function () {
      if (_this.source === 'camera') {
        var _this$otPublisher;

        var divId = (_this$otPublisher = _this.otPublisher) == null ? void 0 : _this$otPublisher.id;

        if (divId) {
          var _this$overlay;

          _this.overlay = createPublisherOverlay({
            id: divId,
            isAudioEnabled: _this.isAudioEnabled(),
            participantName: _this.name
          });
          (_this$overlay = _this.overlay) == null ? void 0 : _this$overlay.on('toggleAudioClicked', function () {
            _this._toggleAudioEnabled();
          });
        } else {
          logger.warn('Could not find stream id when trying to create camera publisher overlay');
        }
      }

      _this.emit('videoElementCreated');
    };

    _this._toggleAudioEnabled = function () {
      if (_this.isAudioEnabled()) {
        _this.disableAudio();
      } else {
        _this.enableAudio();
      }
    };

    _this.isVideoEnabled = function () {
      var _this$otPublisher2, _this$otPublisher2$ge;

      return !!((_this$otPublisher2 = _this.otPublisher) != null && (_this$otPublisher2$ge = _this$otPublisher2.getVideoSource()) != null && _this$otPublisher2$ge.track);
    };

    _this.isAudioEnabled = function () {
      var _this$otPublisher3, _this$otPublisher3$ge;

      return !!((_this$otPublisher3 = _this.otPublisher) != null && (_this$otPublisher3$ge = _this$otPublisher3.getAudioSource()) != null && _this$otPublisher3$ge.enabled);
    };

    _this.enableVideo = function () {
      var _this$otPublisher4;

      return (_this$otPublisher4 = _this.otPublisher) == null ? void 0 : _this$otPublisher4.publishVideo(true);
    };

    _this.disableVideo = function () {
      var _this$otPublisher5;

      return (_this$otPublisher5 = _this.otPublisher) == null ? void 0 : _this$otPublisher5.publishVideo(false);
    };

    _this.enableAudio = function () {
      var _this$otPublisher6, _this$overlay2;

      (_this$otPublisher6 = _this.otPublisher) == null ? void 0 : _this$otPublisher6.publishAudio(true);
      (_this$overlay2 = _this.overlay) == null ? void 0 : _this$overlay2.setAudioEnabled();
    };

    _this.disableAudio = function () {
      var _this$otPublisher7, _this$overlay3;

      (_this$otPublisher7 = _this.otPublisher) == null ? void 0 : _this$otPublisher7.publishAudio(false);
      (_this$overlay3 = _this.overlay) == null ? void 0 : _this$overlay3.setAudioDisabled();
    };

    _this.getVideoDevice = function () {
      var videoDevice = {
        deviceId: '',
        label: '',
        kind: 'videoInput'
      };

      if (_this.otPublisher) {
        var _this$otPublisher$get = _this.otPublisher.getVideoSource(),
            deviceId = _this$otPublisher$get.deviceId,
            track = _this$otPublisher$get.track;

        videoDevice.deviceId = deviceId || '';
        videoDevice.label = (track == null ? void 0 : track.label) || '';
      }

      return videoDevice;
    };

    _this.setVideoDevice = /*#__PURE__*/function () {
      var _ref2 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2(videoDeviceId) {
        var _this$otPublisher8;

        return runtime_1.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return (_this$otPublisher8 = _this.otPublisher) == null ? void 0 : _this$otPublisher8.setVideoSource(videoDeviceId);

              case 2:
                return _context2.abrupt("return", _context2.sent);

              case 3:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      return function (_x3) {
        return _ref2.apply(this, arguments);
      };
    }();

    _this.getAudioDevice = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee3() {
      var _this$otPublisher9;

      var track, deviceId;
      return runtime_1.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              track = (_this$otPublisher9 = _this.otPublisher) == null ? void 0 : _this$otPublisher9.getAudioSource();

              if (!track) {
                _context3.next = 7;
                break;
              }

              _context3.next = 4;
              return getDeviceId(track);

            case 4:
              _context3.t0 = _context3.sent;
              _context3.next = 8;
              break;

            case 7:
              _context3.t0 = '';

            case 8:
              deviceId = _context3.t0;
              return _context3.abrupt("return", {
                deviceId: deviceId,
                label: (track == null ? void 0 : track.label) || '',
                kind: 'audioInput'
              });

            case 10:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    _this.setAudioDevice = /*#__PURE__*/function () {
      var _ref4 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee4(audioDeviceId) {
        var _this$otPublisher10;

        return runtime_1.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return (_this$otPublisher10 = _this.otPublisher) == null ? void 0 : _this$otPublisher10.setAudioSource(audioDeviceId);

              case 2:
                return _context4.abrupt("return", _context4.sent);

              case 3:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4);
      }));

      return function (_x4) {
        return _ref4.apply(this, arguments);
      };
    }();

    _this.destroyOTPublisher = function () {
      var _this$otPublisher11;

      return (_this$otPublisher11 = _this.otPublisher) == null ? void 0 : _this$otPublisher11.destroy();
    };

    _this.setVideoFilter = /*#__PURE__*/function () {
      var _ref5 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee5(videoFilter) {
        var _this$otPublisher12;

        return runtime_1.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return (_this$otPublisher12 = _this.otPublisher) == null ? void 0 : _this$otPublisher12.applyVideoFilter(videoFilter);

              case 2:
                return _context5.abrupt("return", _context5.sent);

              case 3:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }));

      return function (_x5) {
        return _ref5.apply(this, arguments);
      };
    }();

    _this.clearVideoFilter = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee6() {
      var _this$otPublisher13;

      return runtime_1.wrap(function _callee6$(_context6) {
        while (1) {
          switch (_context6.prev = _context6.next) {
            case 0:
              _context6.next = 2;
              return (_this$otPublisher13 = _this.otPublisher) == null ? void 0 : _this$otPublisher13.clearVideoFilter();

            case 2:
              return _context6.abrupt("return", _context6.sent);

            case 3:
            case "end":
              return _context6.stop();
          }
        }
      }, _callee6);
    }));

    _this.setDisabledImageURI = function (imageURI) {
      var _this$otPublisher14;

      (_this$otPublisher14 = _this.otPublisher) == null ? void 0 : _this$otPublisher14.setStyle('backgroundImageURI', imageURI);
    };

    _this.source = source;
    _this.name = name;
    return _this;
  }

  return Publisher;
}(events.EventEmitter);

var CameraPublisher = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(CameraPublisher, _EventEmitter);

  function CameraPublisher(session, defaultTargetElement, analytics, name) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this._defaultTargetElement = defaultTargetElement;

    var _publisher = new Publisher('camera', name);

    var _attachEventsToCameraPublisher = function _attachEventsToCameraPublisher() {
      _publisher.on('audioLevelUpdated', function (audioLevel) {
        _this.emit('audioLevelUpdated', audioLevel);
      });

      _publisher.on('videoElementCreated', function () {
        return _this.emit('created');
      });

      _publisher.on('destroyed', function () {
        return _this.emit('destroyed');
      });

      _publisher.on('accessAllowed', function () {
        _this.emit('accessAllowed');
      });

      _publisher.on('accessDenied', function () {
        _this.emit('accessDenied');
      });

      _publisher.on('accessDialogOpened', function () {
        _this.emit('accessDialogOpened');
      });

      _publisher.on('accessDialogClosed', function (reason) {
        _this.emit('accessDialogClosed', reason);
      });
    };

    _this.isVideoEnabled = function () {
      return _publisher.isVideoEnabled();
    };

    _this.isAudioEnabled = function () {
      return _publisher.isAudioEnabled();
    };

    _this.enableVideo = function () {
      analytics.log(logAction.cameraPublisherEnableVideo, logVariation.attempt);

      _publisher.enableVideo();

      analytics.log(logAction.cameraPublisherEnableVideo, logVariation.success);
    };

    _this.disableVideo = function () {
      analytics.log(logAction.cameraPublisherDisableVideo, logVariation.attempt);

      _publisher.disableVideo();

      analytics.log(logAction.cameraPublisherDisableVideo, logVariation.success);
    };

    _this.enableAudio = function () {
      analytics.log(logAction.cameraPublisherEnableAudio, logVariation.attempt);

      _publisher.enableAudio();

      analytics.log(logAction.cameraPublisherEnableAudio, logVariation.success);
    };

    _this.disableAudio = function () {
      analytics.log(logAction.cameraPublisherDisableAudio, logVariation.attempt);

      _publisher.disableAudio();

      analytics.log(logAction.cameraPublisherDisableAudio, logVariation.success);
    };

    _this.getVideoDevice = function () {
      analytics.log(logAction.getVideoDevice, logVariation.attempt);

      var videoDevice = _publisher.getVideoDevice();

      analytics.log(logAction.getVideoDevice, logVariation.success);
      return videoDevice;
    };

    _this.setVideoDevice = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(deviceId) {
        return runtime_1.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                analytics.log(logAction.setVideoDevice, logVariation.attempt);
                _context.prev = 1;
                _context.next = 4;
                return _publisher.setVideoDevice(deviceId);

              case 4:
                analytics.log(logAction.setVideoDevice, logVariation.success);
                _context.next = 11;
                break;

              case 7:
                _context.prev = 7;
                _context.t0 = _context["catch"](1);
                analytics.log(logAction.setVideoDevice, logVariation.failure, {
                  error: _context.t0
                });
                throw _context.t0;

              case 11:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, null, [[1, 7]]);
      }));

      return function (_x) {
        return _ref.apply(this, arguments);
      };
    }();

    _this.getAudioDevice = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2() {
      var audioDevice;
      return runtime_1.wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              analytics.log(logAction.getAudioDevice, logVariation.attempt);
              _context2.next = 3;
              return _publisher.getAudioDevice();

            case 3:
              audioDevice = _context2.sent;
              analytics.log(logAction.getAudioDevice, logVariation.success);
              return _context2.abrupt("return", audioDevice);

            case 6:
            case "end":
              return _context2.stop();
          }
        }
      }, _callee2);
    }));

    _this.setAudioDevice = /*#__PURE__*/function () {
      var _ref3 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee3(deviceId) {
        return runtime_1.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                analytics.log(logAction.setAudioDevice, logVariation.attempt);
                _context3.prev = 1;
                _context3.next = 4;
                return _publisher.setAudioDevice(deviceId);

              case 4:
                analytics.log(logAction.setAudioDevice, logVariation.success);
                _context3.next = 11;
                break;

              case 7:
                _context3.prev = 7;
                _context3.t0 = _context3["catch"](1);
                analytics.log(logAction.setAudioDevice, logVariation.failure, {
                  error: _context3.t0
                });
                throw _context3.t0;

              case 11:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, null, [[1, 7]]);
      }));

      return function (_x2) {
        return _ref3.apply(this, arguments);
      };
    }();

    _this.destroyCameraPublisher = function () {
      try {
        analytics.log(logAction.destroyCameraPublisher, logVariation.attempt);

        _publisher.destroyOTPublisher();

        analytics.log(logAction.destroyCameraPublisher, logVariation.success);
      } catch (err) {
        analytics.log(logAction.destroyCameraPublisher, logVariation.failure);
      }
    };

    _this.initPublisher = /*#__PURE__*/function () {
      var _ref4 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee4(publisherOptions) {
        var _publisherOptions, targetElement, publisherProperties, target;

        return runtime_1.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                if (publisherOptions === void 0) {
                  publisherOptions = {};
                }

                _publisherOptions = publisherOptions, targetElement = _publisherOptions.targetElement, publisherProperties = _publisherOptions.publisherProperties;
                target = targetElement != null ? targetElement : _this._defaultTargetElement;

                _attachEventsToCameraPublisher();

                _context4.next = 6;
                return _publisher.initOTPublisher(target, publisherProperties);

              case 6:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4);
      }));

      return function (_x3) {
        return _ref4.apply(this, arguments);
      };
    }();

    _this.publish = /*#__PURE__*/function () {
      var _ref5 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee5(publisherOptions) {
        var otPublisher;
        return runtime_1.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                if (publisherOptions === void 0) {
                  publisherOptions = {};
                }

                analytics.log(logAction.publishCameraPublisher, logVariation.attempt, {
                  publisherOptions: publisherOptions
                });
                _context5.next = 4;
                return _publisher.getOTPublisher();

              case 4:
                otPublisher = _context5.sent;

                if (otPublisher) {
                  _context5.next = 7;
                  break;
                }

                throw new Error('OT Publisher not initialized');

              case 7:
                return _context5.abrupt("return", new Promise(function (resolve, reject) {
                  session.publish(otPublisher, function (error) {
                    if (error) {
                      logger.error('Failed to publisher', error);
                      analytics.log(logAction.publishCameraPublisher, logVariation.failure, {
                        error: error
                      });
                      reject(error);
                    } else {
                      logger.info('Published camera to session');
                      analytics.log(logAction.publishCameraPublisher, logVariation.success);
                      resolve();
                    }
                  });
                }));

              case 8:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }));

      return function (_x4) {
        return _ref5.apply(this, arguments);
      };
    }();

    _this.setVideoFilter = /*#__PURE__*/function () {
      var _ref6 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee6(videoFilter) {
        return runtime_1.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.prev = 0;
                analytics.log(logAction.setVideoFilter, logVariation.attempt);
                _context6.next = 4;
                return _publisher.setVideoFilter(videoFilter);

              case 4:
                analytics.log(logAction.setVideoFilter, logVariation.success);
                _context6.next = 11;
                break;

              case 7:
                _context6.prev = 7;
                _context6.t0 = _context6["catch"](0);
                analytics.log(logAction.setVideoFilter, logVariation.failure, {
                  error: _context6.t0
                });
                throw _context6.t0;

              case 11:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, null, [[0, 7]]);
      }));

      return function (_x5) {
        return _ref6.apply(this, arguments);
      };
    }();

    _this.clearVideoFilter = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee7() {
      return runtime_1.wrap(function _callee7$(_context7) {
        while (1) {
          switch (_context7.prev = _context7.next) {
            case 0:
              analytics.log(logAction.clearVideoFilter, logVariation.attempt);
              _context7.prev = 1;
              _context7.next = 4;
              return _publisher.clearVideoFilter();

            case 4:
              analytics.log(logAction.clearVideoFilter, logVariation.success);
              _context7.next = 11;
              break;

            case 7:
              _context7.prev = 7;
              _context7.t0 = _context7["catch"](1);
              analytics.log(logAction.clearVideoFilter, logVariation.failure, {
                error: _context7.t0
              });
              throw _context7.t0;

            case 11:
            case "end":
              return _context7.stop();
          }
        }
      }, _callee7, null, [[1, 7]]);
    }));

    _this.setDisabledImageURI = function (imageURI) {
      _publisher.setDisabledImageURI(imageURI);
    };

    return _this;
  }

  return CameraPublisher;
}(events.EventEmitter);

var NOT_SCREEN_SHARING_ERROR = 'Client is not screen sharing';

var ScreenPublisher = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(ScreenPublisher, _EventEmitter);

  function ScreenPublisher(session, targetElement, analytics) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.isScreenSharing = false;
    _this._defaultTargetElement = targetElement;

    var _publisher = new Publisher('screen');

    var _attachEventsToScreenPublisher = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee() {
        return runtime_1.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _publisher.on('audioLevelUpdated', function (audioLevel) {
                  _this.emit('audioLevelUpdated', audioLevel);
                });

                _publisher.on('videoElementCreated', function () {
                  return _this.emit('started');
                });

                _publisher.on('destroyed', function () {
                  return _this.emit('stopped');
                });

              case 3:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function _attachEventsToScreenPublisher() {
        return _ref.apply(this, arguments);
      };
    }();

    _this.start = /*#__PURE__*/function () {
      var _ref2 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2(targetElement) {
        var _screenPub$element;

        var target, screenPub;
        return runtime_1.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                if (!_publisher) {
                  _publisher = new Publisher('screen');
                }

                target = targetElement != null ? targetElement : _this._defaultTargetElement;

                _attachEventsToScreenPublisher();

                _context2.next = 5;
                return _publisher.initOTPublisher(target, {
                  showControls: true,
                  style: {
                    buttonDisplayMode: 'off'
                  }
                });

              case 5:
                screenPub = _context2.sent;
                screenPub == null ? void 0 : (_screenPub$element = screenPub.element) == null ? void 0 : _screenPub$element.classList.add('OT_screenshare');
                _this.isScreenSharing = true;
                return _context2.abrupt("return", new Promise(function (resolve, reject) {
                  session.publish(screenPub, function (error) {
                    if (error) {
                      reject(error);
                    } else {
                      resolve();
                    }
                  });
                }));

              case 9:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      return function (_x) {
        return _ref2.apply(this, arguments);
      };
    }();

    _this.stop = function () {
      var _publisher2;

      (_publisher2 = _publisher) == null ? void 0 : _publisher2.destroyOTPublisher(); // @ts-ignore

      _publisher = undefined;
      _this.isScreenSharing = false;
    };

    _this.isVideoEnabled = function () {
      var _publisher3;

      return _this.isScreenSharing && ((_publisher3 = _publisher) == null ? void 0 : _publisher3.isVideoEnabled());
    };

    _this.isAudioEnabled = function () {
      var _publisher4;

      return _this.isScreenSharing && ((_publisher4 = _publisher) == null ? void 0 : _publisher4.isAudioEnabled());
    };

    _this.enableVideo = function () {
      analytics.log(logAction.screenPublisherEnableVideo, logVariation.attempt);

      if (_this.isScreenSharing) {
        var _publisher5;

        (_publisher5 = _publisher) == null ? void 0 : _publisher5.enableVideo();
        analytics.log(logAction.screenPublisherEnableVideo, logVariation.success);
      } else {
        analytics.log(logAction.screenPublisherEnableVideo, logVariation.failure, {
          error: NOT_SCREEN_SHARING_ERROR
        });
      }
    };

    _this.disableVideo = function () {
      analytics.log(logAction.screenPublisherDisableVideo, logVariation.attempt);

      if (_this.isScreenSharing) {
        var _publisher6;

        (_publisher6 = _publisher) == null ? void 0 : _publisher6.disableVideo();
        analytics.log(logAction.screenPublisherDisableVideo, logVariation.success);
      } else {
        analytics.log(logAction.screenPublisherDisableVideo, logVariation.failure, {
          error: NOT_SCREEN_SHARING_ERROR
        });
      }
    };

    _this.enableAudio = function () {
      analytics.log(logAction.screenPublisherEnableAudio, logVariation.attempt);

      if (_this.isScreenSharing) {
        var _publisher7;

        (_publisher7 = _publisher) == null ? void 0 : _publisher7.enableAudio();
        analytics.log(logAction.screenPublisherEnableAudio, logVariation.success);
      } else {
        analytics.log(logAction.screenPublisherEnableAudio, logVariation.failure, {
          error: NOT_SCREEN_SHARING_ERROR
        });
      }
    };

    _this.disableAudio = function () {
      analytics.log(logAction.screenPublisherDisableAudio, logVariation.attempt);

      if (_this.isScreenSharing) {
        var _publisher8;

        (_publisher8 = _publisher) == null ? void 0 : _publisher8.disableAudio();
        analytics.log(logAction.screenPublisherDisableAudio, logVariation.success);
      } else {
        analytics.log(logAction.screenPublisherDisableAudio, logVariation.failure, {
          error: NOT_SCREEN_SHARING_ERROR
        });
      }
    };

    _this.setDisabledImageURI = function (imageURI) {
      _publisher.setDisabledImageURI(imageURI);
    };

    return _this;
  }

  return ScreenPublisher;
}(events.EventEmitter);

var ScreenSubscriber = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(ScreenSubscriber, _EventEmitter);

  function ScreenSubscriber(stream, otSubscriber, analytics) {
    var _otSubscriber$element;

    var _this;

    _this = _EventEmitter.call(this) || this;
    _this._stream = stream;

    var _subscriber = new Subscriber(otSubscriber);

    (_otSubscriber$element = otSubscriber.element) == null ? void 0 : _otSubscriber$element.classList.add('MP_screenshare_subscriber');

    _subscriber.on('audioLevelUpdated', function (audioLevel) {
      _this.emit('audioLevelUpdated', audioLevel);
    });

    _subscriber.on('destroyed', function () {
      return _this.emit('destroyed');
    });

    _subscriber.on('videoElementCreated', function () {
      _this.emit('created');
    });

    _this.id = _subscriber.id;

    _this.getSubscriberElement = function () {
      return _subscriber == null ? void 0 : _subscriber.getSubscriberElement();
    };

    _this.isVideoEnabled = function () {
      return _subscriber == null ? void 0 : _subscriber.isVideoEnabled();
    };

    _this.isAudioEnabled = function () {
      return _subscriber == null ? void 0 : _subscriber.isAudioEnabled();
    };

    _this.enableVideo = function () {
      analytics.log(logAction.screenSubscriberEnableVideo, logVariation.attempt);

      if (_subscriber) {
        _subscriber.enableVideo();

        analytics.log(logAction.screenSubscriberEnableVideo, logVariation.success);
      } else {
        analytics.log(logAction.screenSubscriberEnableVideo, logVariation.failure);
      }
    };

    _this.disableVideo = function () {
      analytics.log(logAction.screenSubscriberDisableVideo, logVariation.attempt);

      if (_subscriber) {
        _subscriber.disableVideo();

        analytics.log(logAction.screenSubscriberDisableVideo, logVariation.success);
      } else {
        analytics.log(logAction.screenSubscriberDisableVideo, logVariation.failure);
      }
    };

    _this.enableAudio = function () {
      analytics.log(logAction.screenSubscriberEnableAudio, logVariation.attempt);

      if (_subscriber) {
        _subscriber.enableAudio();

        analytics.log(logAction.screenSubscriberEnableAudio, logVariation.success);
      } else {
        analytics.log(logAction.screenSubscriberEnableAudio, logVariation.failure);
      }
    };

    _this.disableAudio = function () {
      analytics.log(logAction.screenSubscriberDisableAudio, logVariation.attempt);

      if (_subscriber) {
        _subscriber.disableAudio();

        analytics.log(logAction.screenSubscriberDisableAudio, logVariation.success);
      } else {
        analytics.log(logAction.screenSubscriberDisableAudio, logVariation.failure);
      }
    };

    _this.setDisabledImageURI = function (imageURI) {
      _subscriber.setDisabledImageURI(imageURI);
    };

    return _this;
  }

  return ScreenSubscriber;
}(events.EventEmitter);
/* We can't use a promise here because the videoElementCreated event may be fired between
 * calling resolve() and the success handler being executed. Instead we use a synchronous callback.
 */

var createScreenSubscriber = function createScreenSubscriber(session, stream, analytics, callback) {
  analytics.log(logAction.createScreenSubscriber, logVariation.attempt);

  var _otSubscriber = session.subscribe(stream, 'layoutContainer', {
    insertMode: 'append',
    style: {
      buttonDisplayMode: 'off',
      nameDisplayMode: 'off',
      videoDisabledDisplayMode: 'off'
    }
  }, function (error) {
    if (error) {
      analytics.log(logAction.createScreenSubscriber, logVariation.failure);
      callback(error);
    } else {
      var screenSubscriber = new ScreenSubscriber(stream, _otSubscriber, analytics);
      analytics.log(logAction.createScreenSubscriber, logVariation.success);
      callback(undefined, screenSubscriber);
    }
  });
};

var SPEAKER_DETECTED_FIRST_TIME_INTERVAL = 100; // this is milliseconds

var LOW_AUDIO_DETECTED_INTERVAL = 100; // this is milliseconds

var MIN_AUDIO_LEVEL = 0;

var SpeakerDetection = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(SpeakerDetection, _EventEmitter);

  function SpeakerDetection() {
    var _this;

    _this = _EventEmitter.apply(this, arguments) || this;
    _this.activity = {};
    return _this;
  }

  var _proto = SpeakerDetection.prototype;

  _proto.onAudioLevelUpdated = function onAudioLevelUpdated(audioLevel) {
    var now = Date.now();
    var isTalking = audioLevel > MIN_AUDIO_LEVEL;

    if (isTalking) {
      //checking below if the activity object has been initialized
      if (Object.keys(this.activity).length === 0) {
        // this is the first time we are hearing the person talk
        // initializing the initial variable
        this.activity = {
          timestamp: now,
          talking: false
        };
      } else if (this.activity.talking) {
        // the person is currently talking
        this.activity.timestamp = now;
      } else if (now - this.activity.timestamp > SPEAKER_DETECTED_FIRST_TIME_INTERVAL) {
        // This part filters out random short noise
        // The person is currently speaking if they have been speaking for awhile
        this.activity.talking = true;
        this.emit('activeSpeakerStatusChanged', {
          isSpeaking: true
        });
      }
    } else if (Object.keys(this.activity).length !== 0 && now - this.activity.timestamp > LOW_AUDIO_DETECTED_INTERVAL) {
      // The person may have stopped talking but we give them a period of time before dispatching the event to remove CSS for this active speaker
      // (this takes into account pauses when one speaks)
      if (this.activity.talking) {
        this.emit('activeSpeakerStatusChanged', {
          isSpeaking: false
        }); // if the active speaker changes externally, the activity tracker gets reset

        this.reset();
      }
    }
  };

  _proto.reset = function reset() {
    this.activity = {};
  };

  return SpeakerDetection;
}(events.EventEmitter);

var CALCULATE_ACTIVE_SPEAKER_THROTTLE_TIME = 1500;

var ActiveSpeakerTracker = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(ActiveSpeakerTracker, _EventEmitter);

  function ActiveSpeakerTracker() {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this._subscriberAudioLevelsBySubscriberId = {};
    _this._participantsBySubscriberId = {};

    _this.onCameraSubscriberDestroyed = function (subscriberId) {
      delete _this._subscriberAudioLevelsBySubscriberId[subscriberId];
      delete _this._participantsBySubscriberId[subscriberId];

      if (_this.activeSpeaker.subscriberId === subscriberId) {
        _this.activeSpeaker = {
          subscriberId: undefined,
          movingAvg: 0,
          participant: undefined
        };
      }

      _this.calculateActiveSpeaker();
    };

    _this.onSubscriberAudioLevelUpdated = function (_ref) {
      var subscriberId = _ref.subscriberId,
          movingAvg = _ref.movingAvg,
          participant = _ref.participant,
          audioLevel = _ref.audioLevel;
      _this._subscriberAudioLevelsBySubscriberId[subscriberId] = movingAvg;
      _this._participantsBySubscriberId[subscriberId] = participant;

      _this.calculateActiveSpeaker();

      if (subscriberId === _this.activeSpeaker.subscriberId) {
        _this.speakerDetection.onAudioLevelUpdated(audioLevel);
      }
    };

    _this._calculateActiveSpeaker = function () {
      var subscriberIdAudioLevelKeyValuePair = Object.entries(_this._subscriberAudioLevelsBySubscriberId);
      var activeSpeaker = subscriberIdAudioLevelKeyValuePair.reduce(function (acc, _ref2) {
        var subscriberId = _ref2[0],
            movingAvg = _ref2[1];

        if (movingAvg > acc.movingAvg) {
          return {
            subscriberId: subscriberId,
            movingAvg: movingAvg,
            participant: _this._participantsBySubscriberId[subscriberId]
          };
        }

        return acc;
      }, {
        subscriberId: undefined,
        movingAvg: 0,
        participant: undefined
      });

      if (activeSpeaker.subscriberId !== _this.activeSpeaker.subscriberId && activeSpeaker.movingAvg > 0.2) {
        var previousActiveSpeaker = _extends({}, _this.activeSpeaker);

        _this.activeSpeaker = activeSpeaker;

        _this.emit('activeSpeakerChanged', {
          newActiveSpeaker: activeSpeaker,
          previousActiveSpeaker: previousActiveSpeaker
        });

        _this.speakerDetection.reset();
      }
    };

    _this.activeSpeaker = {
      movingAvg: 0,
      subscriberId: undefined,
      participant: undefined
    };
    _this.speakerDetection = new SpeakerDetection();

    _this.speakerDetection.on('activeSpeakerStatusChanged', function (payload) {
      _this.emit('activeSpeakerStatusChanged', payload);
    });

    _this.calculateActiveSpeaker = lodash.throttle(_this._calculateActiveSpeaker, CALCULATE_ACTIVE_SPEAKER_THROTTLE_TIME, {
      // So we don't send events after subscriber is destroyed
      leading: true,
      trailing: false
    });
    return _this;
  }

  return ActiveSpeakerTracker;
}(events.EventEmitter);

var Participant = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(Participant, _EventEmitter);

  function Participant(connection) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.name = null;
    _this.isParticipantJoinedSent = false;
    _this.isMe = false;
    _this.connection = connection;
    var connectionId = connection.connectionId,
        data = connection.data;
    _this.id = connectionId;
    _this.connectionData = data;
    return _this;
  }

  var _proto = Participant.prototype;

  _proto.setCameraSubscriber = function setCameraSubscriber(cameraSubscriber) {
    var _this2 = this;

    this.camera = cameraSubscriber;
    cameraSubscriber.on('created', function () {
      _this2.emit('cameraCreated', cameraSubscriber);
    });
    cameraSubscriber.on('destroyed', function () {
      _this2.emit('cameraDestroyed');
    });
  };

  _proto.setScreenSubscriber = function setScreenSubscriber(screenSubscriber) {
    var _this3 = this;

    this.screen = screenSubscriber;
    screenSubscriber.on('created', function () {
      _this3.emit('screenCreated');
    });
    screenSubscriber.on('destroyed', function () {
      _this3.emit('screenDestroyed');
    });
  };

  return Participant;
}(events.EventEmitter);

var ParticipantWrapper = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(ParticipantWrapper, _EventEmitter);

  function ParticipantWrapper(participant) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.isMe = false;
    _this.id = participant.id;
    _this.connectionData = participant.connectionData;
    /*
     * Here we use defineProperty to set a getting because participant.screen
     * and participant.camera are initially undefined and setting e.g.:
     * this.camera = participant.camera would not work when the object reference changes.
     */

    Object.defineProperty(_assertThisInitialized(_this), 'camera', {
      get: function get() {
        return participant.camera;
      }
    });
    Object.defineProperty(_assertThisInitialized(_this), 'screen', {
      get: function get() {
        return participant.screen;
      }
    });
    Object.defineProperty(_assertThisInitialized(_this), 'name', {
      get: function get() {
        return participant.name;
      }
    });
    participant.on('cameraCreated', function (cameraSubscriber) {
      _this.emit('cameraCreated', cameraSubscriber);
    });
    participant.on('cameraDestroyed', function () {
      _this.emit('cameraDestroyed');
    });
    participant.on('screenCreated', function (screenSubscriber) {
      _this.emit('screenCreated', screenSubscriber);
    });
    participant.on('screenDestroyed', function () {
      _this.emit('screenDestroyed');
    });
    return _this;
  }

  return ParticipantWrapper;
}(events.EventEmitter);

var removeUndefinedProperties = function removeUndefinedProperties(properties) {
  return Object.entries(properties).reduce(function (acc, _ref) {
    var propName = _ref[0],
        value = _ref[1];

    if (value !== undefined) {
      acc[propName] = value;
    }

    return acc;
  }, {});
};
var deleteAllEntries = function deleteAllEntries(object) {
  Object.keys(object).forEach(function (key) {
    delete object[key];
  });
};

/* Using a permissive value here to include large phones and any future large phones while excluding tablets
See common device sizes here: https://experienceleague.adobe.com/docs/target/using/experiences/vec/mobile-viewports.html?lang=en
E.g. Samsung Galaxy Note 5	480. iPhone 12 Pro Max: 428.
Note this is to be used with max-device-width query which uses CSS pixel width which takes into account pixel density.
*/

var MAX_MOBILE_WIDTH = 500;
var uaParser = /*#__PURE__*/new UAParser(navigator.userAgent);
var uaDevice = /*#__PURE__*/uaParser.getDevice();

var hasTouchScreen = function hasTouchScreen() {
  if ('maxTouchPoints' in navigator) {
    return navigator.maxTouchPoints > 0;
  }

  var query = window.matchMedia('(pointer:coarse)');
  return query.matches;
};

var hasMobileScreenWidth = function hasMobileScreenWidth() {
  var query = window.matchMedia("(max-device-width: " + MAX_MOBILE_WIDTH + "px)");
  return query.matches;
};
/* Determine whether device is a mobile.
 *  - First try to determine via user agent detection
 *  - If that fails then check for touchscreen and a mobile size screen
 */


var isMobile = function isMobile() {
  if (uaDevice.type) {
    return uaDevice.type === 'mobile';
  }

  return hasMobileScreenWidth() && hasTouchScreen();
};

var createExternalPromiseResolver = function createExternalPromiseResolver() {
  var resolver, rejector;
  var promise = new Promise(function (resolve, reject) {
    resolver = resolve;
    rejector = reject;
  }); // We must catch the promise otherwise jest will fail

  promise["catch"](function () {});
  return {
    promise: promise,
    // @ts-ignore
    resolver: resolver,
    // @ts-ignore
    rejector: rejector
  };
};

var LocalParticipant = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(LocalParticipant, _EventEmitter);

  function LocalParticipant(connection, name) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.isMe = true;
    _this.id = connection.connectionId;
    _this.name = name;
    _this.connectionData = connection.data;
    return _this;
  }

  return LocalParticipant;
}(events.EventEmitter);

var LocalParticipantWrapper = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(LocalParticipantWrapper, _EventEmitter);

  function LocalParticipantWrapper(localParticipant) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.isMe = true;
    _this.id = localParticipant.id;
    _this.connectionData = localParticipant.connectionData;
    _this.name = localParticipant.name;
    return _this;
  }

  return LocalParticipantWrapper;
}(events.EventEmitter);

var PARTICIPANT_NAME_RECEIVED_TIMEOUT = 300;

var Room = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(Room, _EventEmitter);

  function Room(roomProperties) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.participants = {};
    _this.participantWrappers = {};
    _this._cameraSubscribers = {};
    _this._screenSubscribers = {};
    _this._visibleParticipantsCount = 0;

    _this._attachOTSessionEventListeners = function () {
      _this._session.on('sessionConnected', function () {
        logger.debug('Connected to session');

        _this.emit('connected');
      });

      _this._session.on('sessionDisconnected', function (event) {
        var reason = event.reason;
        logger.debug("SessionDisconnect, reason: " + reason);

        if (_this.camera) {
          _this.camera.destroyCameraPublisher();
        }

        if (_this.screen) {
          _this.screen.stop();
        }

        _this.emit('disconnected', reason);
      });

      _this._session.on('sessionReconnecting', function () {
        logger.debug('Session Reconnecting');

        _this.emit('reconnecting');
      });

      _this._session.on('sessionReconnected', function () {
        logger.debug('Session Reconnected');

        _this.emit('reconnected');
      });

      _this._session.on('streamCreated', /*#__PURE__*/function () {
        var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(event) {
          var stream, connectionId, participant;
          return runtime_1.wrap(function _callee$(_context) {
            while (1) {
              switch (_context.prev = _context.next) {
                case 0:
                  _context.prev = 0;
                  _context.next = 3;
                  return _this._waitUntilJoined.promise;

                case 3:
                  _context.next = 8;
                  break;

                case 5:
                  _context.prev = 5;
                  _context.t0 = _context["catch"](0);
                  return _context.abrupt("return");

                case 8:
                  stream = event.stream;
                  connectionId = stream.connection.connectionId;
                  participant = _this.participants[connectionId];

                  if (participant && !participant.isMe) {
                    logger.debug("Stream created for participant: " + connectionId);

                    _this._onParticipantStreamCreated(_this._session, stream, participant, _this._shouldEnableParticipantVideo());
                  } else {
                    logger.info("No participant found for new stream with connection id " + connectionId);
                  }

                case 12:
                case "end":
                  return _context.stop();
              }
            }
          }, _callee, null, [[0, 5]]);
        }));

        return function (_x) {
          return _ref.apply(this, arguments);
        };
      }());

      _this._session.on('streamDestroyed', function (event) {
        var stream = event.stream;
        var connectionId = stream.connection.connectionId;
        var participant = _this.participants[connectionId];

        if (participant) {
          logger.debug("Stream destroyed for participant: " + connectionId);

          _this._onParticipantStreamDestroyed();
        }

        if (!_this.useMobileLayout && _this._shouldEnableParticipantVideo()) {
          logger.info('Subscribing to all participants video');
          Object.values(_this.participants).forEach(function (participant) {
            if (!participant.isMe) {
              var _participant$camera;

              (_participant$camera = participant.camera) == null ? void 0 : _participant$camera.enableVideo();
            }
          });
        }
      });

      _this._session.on('connectionCreated', /*#__PURE__*/function () {
        var _ref2 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2(event) {
          var connection, _this$_createParticip, participant, participantWrapper;

          return runtime_1.wrap(function _callee2$(_context2) {
            while (1) {
              switch (_context2.prev = _context2.next) {
                case 0:
                  connection = event.connection;
                  _this$_createParticip = _this._createParticipant(connection), participant = _this$_createParticip.participant, participantWrapper = _this$_createParticip.participantWrapper;

                  if (_this._isMe(connection)) {
                    _context2.next = 12;
                    break;
                  }

                  _context2.prev = 3;
                  _context2.next = 6;
                  return _this._sendParticipantName(connection);

                case 6:
                  _context2.next = 11;
                  break;

                case 8:
                  _context2.prev = 8;
                  _context2.t0 = _context2["catch"](3);
                  logger.warn('Attempted to send the participant name to a participant that is already disconnected.');

                case 11:
                  setTimeout(function () {
                    // Check if the participant is still connected.
                    if (!_this.participants[participant.id]) {
                      return;
                    }

                    if (_this.participants[participant.id].name === null) {
                      logger.info('Timeout waiting for participant name, using empty name.');

                      _this._onParticipantNameReceived(participantWrapper, '');
                    }
                  }, PARTICIPANT_NAME_RECEIVED_TIMEOUT);

                case 12:
                case "end":
                  return _context2.stop();
              }
            }
          }, _callee2, null, [[3, 8]]);
        }));

        return function (_x2) {
          return _ref2.apply(this, arguments);
        };
      }());

      _this._session.on('connectionDestroyed', function (event) {
        var connection = event.connection,
            reason = event.reason;
        var participantId = connection.connectionId;
        var participant = _this.participants[participantId];

        if (participant && !participant.isMe) {
          var isParticipantJoinedSent = participant.isParticipantJoinedSent;
          var participantWrapper = _this.participantWrappers[participantId];
          delete _this.participantWrappers[participantId];
          delete _this.participants[participantId];

          if (isParticipantJoinedSent) {
            logger.info("Participant left: " + participantWrapper);

            _this.emit('participantLeft', participantWrapper, reason);
          }
        }
      });

      _this._session.on('signal', _this._onSignalReceived);
    };

    _this._createParticipant = function (connection) {
      var participant, participantWrapper;

      if (_this._isMe(connection)) {
        var _this$_createLocalPar = _this._createLocalParticipant(connection, _this.participantName);

        participant = _this$_createLocalPar.participant;
        participantWrapper = _this$_createLocalPar.participantWrapper;
      } else {
        var _this$_createRemotePa = _this._createRemoteParticipant(connection);

        participant = _this$_createRemotePa.participant;
        participantWrapper = _this$_createRemotePa.participantWrapper;
      }

      _this.participants[participant.id] = participant;
      _this.participantWrappers[participant.id] = participantWrapper;
      return {
        participant: participant,
        participantWrapper: participantWrapper
      };
    };

    _this._createLocalParticipant = function (connection, name) {
      var participant = new LocalParticipant(connection, name);
      var participantWrapper = new LocalParticipantWrapper(participant);
      return {
        participant: participant,
        participantWrapper: participantWrapper
      };
    };

    _this._createRemoteParticipant = function (connection) {
      var participant = new Participant(connection);
      var participantWrapper = new ParticipantWrapper(participant);
      return {
        participant: participant,
        participantWrapper: participantWrapper
      };
    };

    _this._removeOTSessionEventListeners = function () {
      _this._session.off();
    };

    _this._createDefaultRoomContainer = function () {
      var element = createDiv('roomContainer', {
        width: '100vw',
        height: '100vh',
        position: 'relative'
      });
      document.body.appendChild(element);
      return element;
    };

    _this._getDefaultPublisherElement = function (type) {
      if (type === void 0) {
        type = 'camera';
      }

      var _assertThisInitialize = _assertThisInitialized(_this),
          _assertThisInitialize2 = _assertThisInitialize.managedLayoutOptions;

      _assertThisInitialize2 = _assertThisInitialize2 === void 0 ? {} : _assertThisInitialize2;
      var screenPublisherContainer = _assertThisInitialize2.screenPublisherContainer,
          cameraPublisherContainer = _assertThisInitialize2.cameraPublisherContainer;
      var customContainer = type === 'camera' ? cameraPublisherContainer : screenPublisherContainer;

      if (customContainer) {
        return getTargetElementFromDOM(customContainer);
      } // default target is layout managed div


      return _this._layoutManager.getLayoutContainerElement();
    };

    _this._connect = function () {
      return new Promise(function (resolve, reject) {
        _this._session.connect(_this.token, function (error) {
          if (error) {
            reject(error);
          } else {
            _this._analytics.update(_this._session.sessionId, _this._session.connection.connectionId, _this.apiKey);

            logger.info('Session connected');
            resolve();
          }
        });
      });
    };

    _this._isMe = function (connection) {
      var _this$_session, _this$_session$connec;

      return !!connection && ((_this$_session = _this._session) == null ? void 0 : (_this$_session$connec = _this$_session.connection) == null ? void 0 : _this$_session$connec.connectionId) === connection.connectionId;
    };

    _this._setOptimalSubscriberResolutions = function () {
      Object.values(_this._cameraSubscribers).forEach(function (cSubscriber) {
        cSubscriber.setOptimalPreferredResolution();
      });
    };

    _this._getCameraSubscriberElement = function (subscriberId) {
      if (!subscriberId) {
        return undefined;
      }

      return _this._cameraSubscribers[subscriberId].getSubscriberElement();
    };

    _this._onParticipantNameReceived = function (participantWrapper, name) {
      var participantId = participantWrapper.id;

      if (_this.participants[participantId]) {
        // Set the name
        _this.participants[participantId].name = name;
        var participant = _this.participants[participantId]; // Make sure we emit participantJoined only one time.

        if (!participant.isMe && !participant.isParticipantJoinedSent) {
          participant.isParticipantJoinedSent = true;

          _this.emit('participantJoined', participantWrapper);
        }
      }
    };

    _this._onSignalReceived = function (event) {
      var participantSenderWrapper = event.from ? _this.participantWrappers[event.from.connectionId] : null;

      if (participantSenderWrapper && event.type === 'signal:MP_INTERNAL_PARTICIPANT_NAME' && !_this._isMe(event.from)) {
        var _event$data;

        _this._onParticipantNameReceived(participantSenderWrapper, (_event$data = event.data) != null ? _event$data : '');

        return;
      }

      var signalData = {
        type: event.type,
        data: event.data,
        from: participantSenderWrapper,
        isSentByMe: _this._isMe(event.from)
      };

      _this.emit('signal', signalData);
    };

    _this._onCameraSubscriberCreated = function (stream, cameraSubscriber) {
      _this._cameraSubscribers[cameraSubscriber.id] = cameraSubscriber;
      var element = cameraSubscriber.getSubscriberElement();
      cameraSubscriber.on('created', function () {
        _this._layoutManager.onCameraSubscriberCreated(element);
      });
      cameraSubscriber.on('destroyed', function () {
        var _this$_layoutManager;

        _this._activeSpeakerTracker.onCameraSubscriberDestroyed(cameraSubscriber.id);

        (_this$_layoutManager = _this._layoutManager) == null ? void 0 : _this$_layoutManager.onCameraSubscriberDestroyed(element);
        delete _this._cameraSubscribers[cameraSubscriber.id];
      });
    };

    _this._onScreenSubscriberCreated = function (stream, screenSubscriber) {
      _this._screenSubscribers[screenSubscriber.id] = screenSubscriber;
      screenSubscriber.on('created', function () {
        _this._layoutManager.onScreenSubscriberCreated(screenSubscriber.id);
      });
      screenSubscriber.on('destroyed', function () {
        var subscriberId = screenSubscriber.id;

        _this._layoutManager.onScreenSubscriberDestroyed(subscriberId);

        delete _this._screenSubscribers[subscriberId];
      });
    };

    _this._onActiveSpeakerStatusChanged = function (payload) {
      _this._layoutManager.onActiveSpeakerStatusChanged(payload);
    };

    _this._onActiveSpeakerChanged = function (_ref3) {
      var newActiveSpeaker = _ref3.newActiveSpeaker,
          previousActiveSpeaker = _ref3.previousActiveSpeaker;

      var newActiveSpeakerElement = _this._getCameraSubscriberElement(newActiveSpeaker.subscriberId);

      var previousActiveSpeakerElement = _this._getCameraSubscriberElement(previousActiveSpeaker.subscriberId);

      _this._layoutManager.onActiveSpeakerChanged({
        newActiveSpeakerElement: newActiveSpeakerElement,
        previousActiveSpeakerElement: previousActiveSpeakerElement
      });

      _this.emit('activeSpeakerChanged', newActiveSpeaker.participant);
    };

    _this._sendParticipantName = function (to) {
      return new Promise(function (resolve, reject) {
        _this._session.signal(removeUndefinedProperties({
          to: to,
          type: 'MP_INTERNAL_PARTICIPANT_NAME',
          data: _this.participantName
        }), function (err) {
          if (err) {
            reject(err);
          }

          resolve();
        });
      });
    };

    _this._shouldEnableParticipantVideo = function () {
      return _this.maxVideoParticipantsOnScreen === undefined || _this._visibleParticipantsCount < _this.maxVideoParticipantsOnScreen;
    };

    _this._shouldDisablePublisherMedia = function () {
      return !!_this.mediaShutoffThreshold && Object.keys(_this.participants).length > _this.mediaShutoffThreshold;
    };

    _this._onParticipantStreamDestroyed = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee3() {
      return runtime_1.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              _this._visibleParticipantsCount = _this._visibleParticipantsCount > 0 ? _this._visibleParticipantsCount - 1 : 0;

            case 1:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    _this._onParticipantStreamCreated = /*#__PURE__*/function () {
      var _ref5 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee4(session, stream, participant, shouldEnableVideo) {
        var videoType;
        return runtime_1.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                videoType = stream.videoType;

                if (videoType === 'screen') {
                  createScreenSubscriber(session, stream, _this._analytics, function (err, screenSubscriber) {
                    if (!err && screenSubscriber) {
                      participant.setScreenSubscriber(screenSubscriber);

                      _this._onScreenSubscriberCreated(stream, screenSubscriber);
                    }
                  });
                } else {
                  createCameraSubscriber(session, stream, shouldEnableVideo, _this._analytics, function (err, cameraSubscriber) {
                    if (!err && cameraSubscriber) {
                      participant.setCameraSubscriber(cameraSubscriber);

                      _this._onCameraSubscriberCreated(stream, cameraSubscriber);

                      cameraSubscriber.on('audioLevelUpdated', function (audioLevel, movingAvg) {
                        _this._activeSpeakerTracker.onSubscriberAudioLevelUpdated({
                          subscriberId: cameraSubscriber.id,
                          movingAvg: movingAvg,
                          participant: participant,
                          audioLevel: audioLevel
                        });
                      });
                    }
                  });

                  if (!shouldEnableVideo) {
                    _this.emit('cameraSubscriberVideoDisabled', participant.id);
                  }

                  _this._visibleParticipantsCount = _this._visibleParticipantsCount + 1;
                }

              case 2:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4);
      }));

      return function (_x3, _x4, _x5, _x6) {
        return _ref5.apply(this, arguments);
      };
    }();

    _this._onCameraSubscriberHiddenByLayoutManager = function (subscriberId) {
      var cameraSubscriber = _this._cameraSubscribers[subscriberId];

      if (cameraSubscriber) {
        logger.debug('Camera subscriber to be hidden in layout, unsubscribing to video: ', cameraSubscriber.id);
        cameraSubscriber.disableVideo();
      }
    };

    _this._onCameraSubscriberDisplayedByLayoutManager = function (subscriberId) {
      var cameraSubscriber = _this._cameraSubscribers[subscriberId];

      if (cameraSubscriber) {
        logger.debug('Camera subscriber to be displayed in layout, subscribing to video: ', cameraSubscriber.id);
        cameraSubscriber.enableVideo();

        var videoElement = _this._getCameraSubscriberElement(subscriberId);

        if (videoElement) {
          _this._layoutManager._removeSubscriberOnLoad(videoElement);
        }
      }
    };

    _this.join = /*#__PURE__*/function () {
      var _ref6 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee5(publisherOptions) {
        var _publisherOptions, targetElement, _publisherOptions$pub, publisherProperties, publisherCreated, connected, joinFailureCleanup;

        return runtime_1.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                if (publisherOptions === void 0) {
                  publisherOptions = {};
                }

                _publisherOptions = publisherOptions, targetElement = _publisherOptions.targetElement, _publisherOptions$pub = _publisherOptions.publisherProperties, publisherProperties = _publisherOptions$pub === void 0 ? {} : _publisherOptions$pub;
                publisherProperties.name = _this.participantName;
                logger.info('Joining room');

                _this._analytics.log(logAction.joinRoom, logVariation.attempt, {
                  publisherOptions: publisherOptions
                });

                _this._attachOTSessionEventListeners();

                publisherCreated = false;
                connected = false;

                joinFailureCleanup = function joinFailureCleanup() {
                  _this._waitUntilJoined.rejector();

                  _this._cleanupOnDisconnect();

                  if (publisherCreated) {
                    _this.camera.destroyCameraPublisher();
                  }

                  if (connected) {
                    _this._session.disconnect();
                  }
                };

                _context5.prev = 9;

                _this.camera.on('destroyed', _this._onCameraPublisherDestroyed);

                _context5.next = 13;
                return _this.camera.initPublisher({
                  targetElement: targetElement,
                  publisherProperties: publisherProperties
                });

              case 13:
                publisherCreated = true;
                _context5.next = 22;
                break;

              case 16:
                _context5.prev = 16;
                _context5.t0 = _context5["catch"](9);
                logger.error('Failed to join room: could not initialize camera publish.', _context5.t0);

                _this._analytics.log(logAction.joinRoom, logVariation.failure, {
                  error: _context5.t0
                });

                joinFailureCleanup();
                throw _context5.t0;

              case 22:
                _context5.prev = 22;
                _context5.next = 25;
                return _this._connect();

              case 25:
                connected = true;
                _context5.next = 34;
                break;

              case 28:
                _context5.prev = 28;
                _context5.t1 = _context5["catch"](22);
                logger.error('Failed to join room: could not connect to session.', _context5.t1);

                _this._analytics.log(logAction.joinRoom, logVariation.failure, {
                  error: _context5.t1
                });

                joinFailureCleanup();
                throw _context5.t1;

              case 34:
                if (_this._shouldDisablePublisherMedia()) {
                  _this.camera.disableAudio();

                  _this.camera.disableVideo();

                  logger.info('mediaShutoffThreshold reached. Turning off publisher audio and video.');

                  _this.emit('cameraPublisherMediaDisabled');
                }

                _context5.prev = 35;
                _context5.next = 38;
                return _this.camera.publish();

              case 38:
                logger.debug('Published camera');
                _context5.next = 47;
                break;

              case 41:
                _context5.prev = 41;
                _context5.t2 = _context5["catch"](35);
                logger.error('Failed to join room: failed to publish to session', _context5.t2);

                _this._analytics.log(logAction.joinRoom, logVariation.failure, {
                  error: _context5.t2
                });

                joinFailureCleanup();
                throw _context5.t2;

              case 47:
                _this._analytics.log(logAction.joinRoom, logVariation.success);

                _this._waitUntilJoined.resolver();

                _this._layoutManager.updateLayout();

              case 50:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, null, [[9, 16], [22, 28], [35, 41]]);
      }));

      return function (_x7) {
        return _ref6.apply(this, arguments);
      };
    }();

    _this._cleanupOnDisconnect = function () {
      _this._removeOTSessionEventListeners();

      _this.camera.off('destroyed', _this._onCameraPublisherDestroyed);

      _this._waitUntilJoined = createExternalPromiseResolver();
      deleteAllEntries(_this.participants);
      deleteAllEntries(_this.participantWrappers);
    };

    _this.leave = function () {
      logger.info('Leaving room');

      _this._analytics.log(logAction.leaveRoom, logVariation.attempt);

      _this._cleanupOnDisconnect();

      return new Promise(function (resolve, reject) {
        try {
          _this._session.on('sessionDisconnected', function () {
            _this._analytics.log(logAction.leaveRoom, logVariation.success);

            logger.info('Left room');
            resolve();
          });

          _this._session.disconnect();
        } catch (error) {
          _this._analytics.log(logAction.leaveRoom, logVariation.failure, {
            error: error
          });

          logger.warn('Error leaving room', error);
          reject(error);
        }
      });
    };

    _this._onCameraPublisherDestroyed = function () {
      logger.error('Disconnecting room because Camera Publisher was destroyed');

      _this._cleanupOnDisconnect();

      _this._session.disconnect();

      _this.emit('disconnected', 'cameraPublisherError');
    };

    _this.setLayoutMode = function (mode) {
      if (_this._layoutManager) {
        _this._layoutManager.setLayoutMode(mode);
      } else {
        logger.error('Attempted to set layout mode, but are not using layout manager.');
        throw new Error('Cannot set layout mode when not using layout manager');
      }
    };

    _this.startScreensharing = function (targetElement) {
      _this._analytics.log(logAction.startScreenSharing, logVariation.attempt);

      return _this.screen.start(targetElement).then(function () {
        logger.info('Started screen sharing.');

        _this._layoutManager.updateLayout();

        _this._analytics.log(logAction.startScreenSharing, logVariation.success);
      })["catch"](function (error) {
        logger.error('Screen sharing failed.');

        _this._analytics.log(logAction.startScreenSharing, logVariation.failure, {
          error: error
        });

        throw error;
      });
    };

    _this.stopScreensharing = function () {
      _this._analytics.log(logAction.stopScreenSharing, logVariation.attempt);

      _this.screen.stop();

      logger.info('Stopped screen sharing.');

      _this._layoutManager.updateLayout();

      _this._analytics.log(logAction.stopScreenSharing, logVariation.success);
    };

    logger.debug('Initializing room with properties', roomProperties);
    var apiKey = roomProperties.apiKey,
        sessionId = roomProperties.sessionId,
        token = roomProperties.token,
        roomContainer = roomProperties.roomContainer,
        mediaShutoffThreshold = roomProperties.mediaShutoffThreshold,
        maxVideoParticipantsOnScreen = roomProperties.maxVideoParticipantsOnScreen,
        _roomProperties$manag = roomProperties.managedLayoutOptions,
        managedLayoutOptions = _roomProperties$manag === void 0 ? {} : _roomProperties$manag,
        _roomProperties$parti = roomProperties.participantName,
        participantName = _roomProperties$parti === void 0 ? '' : _roomProperties$parti,
        iceConfig = roomProperties.iceConfig;
    _this._analytics = new Analytics({
      sessionId: sessionId,
      apiKey: apiKey
    });

    _this._analytics.log(logAction.initRoom, logVariation.attempt, {
      roomProperties: roomProperties
    });

    if (!apiKey || !sessionId || !token) {
      var error = 'Invalid credentials. Check the API_KEY, TOKEN, SESSION_ID passed';

      _this._analytics.log(logAction.initRoom, logVariation.failure, {
        error: error
      });

      logger.error(error);
      throw new Error(error);
    }

    _this.apiKey = apiKey;
    _this.roomId = sessionId;
    _this.token = token;
    _this.iceConfig = iceConfig;
    _this.roomContainer = roomContainer || _this._createDefaultRoomContainer();
    _this.mediaShutoffThreshold = mediaShutoffThreshold;
    _this._waitUntilJoined = createExternalPromiseResolver();

    if (maxVideoParticipantsOnScreen !== undefined && typeof maxVideoParticipantsOnScreen !== 'number' || typeof maxVideoParticipantsOnScreen === 'number' && maxVideoParticipantsOnScreen < 0) {
      logger.warn('Warning: maxVideoParticipantsOnScreen must be a number greater than or equal to 0. Received: ', maxVideoParticipantsOnScreen);
    } else {
      _this.maxVideoParticipantsOnScreen = maxVideoParticipantsOnScreen;
    }

    _this.participantName = participantName;

    var _managedLayoutOptions = managedLayoutOptions.deviceLayoutMode,
        deviceLayoutMode = _managedLayoutOptions === void 0 ? 'auto' : _managedLayoutOptions,
        layoutOptions = _objectWithoutPropertiesLoose(managedLayoutOptions, ["deviceLayoutMode"]);

    _this.useMobileLayout = deviceLayoutMode === 'mobile' || deviceLayoutMode === 'auto' && isMobile();
    logger.debug('Initializing room with layout manager');
    _this.managedLayoutOptions = _extends({
      layoutMode: 'grid',
      isMobileLayout: _this.useMobileLayout
    }, layoutOptions);
    _this._session = OT.initSession(_this.apiKey, _this.roomId, {
      iceConfig: _this.iceConfig
    });
    _this._layoutManager = new LayoutManager(_this.roomContainer, _this.managedLayoutOptions, maxVideoParticipantsOnScreen);

    _this._layoutManager.on('layoutComplete', function () {
      _this._setOptimalSubscriberResolutions();
    });

    _this._layoutManager.on('cameraSubscriberHidden', _this._onCameraSubscriberHiddenByLayoutManager);

    _this._layoutManager.on('cameraSubscriberDisplayed', _this._onCameraSubscriberDisplayedByLayoutManager);

    _this.camera = new CameraPublisher(_this._session, _this._getDefaultPublisherElement(), _this._analytics, _this.participantName);
    _this.screen = new ScreenPublisher(_this._session, _this._getDefaultPublisherElement('screen'), _this._analytics);
    _this._activeSpeakerTracker = new ActiveSpeakerTracker();

    _this._activeSpeakerTracker.on('activeSpeakerChanged', _this._onActiveSpeakerChanged);

    _this._activeSpeakerTracker.on('activeSpeakerStatusChanged', _this._onActiveSpeakerStatusChanged);

    _this._analytics.log(logAction.initRoom, logVariation.success);

    return _this;
  }

  var _proto = Room.prototype;

  _proto.signal = function signal(_ref7) {
    var _this2 = this;

    var to = _ref7.to,
        data = _ref7.data,
        type = _ref7.type,
        retryAfterReconnect = _ref7.retryAfterReconnect;
    var participant = to && this.participants[to.id];
    var signalingOptions = removeUndefinedProperties({
      data: data,
      type: type,
      retryAfterReconnect: retryAfterReconnect,
      to: participant == null ? void 0 : participant.connection
    });
    logger.debug('Sending signal', signalingOptions);
    return new Promise(function (resolve, reject) {
      _this2._session.signal(signalingOptions, function (err) {
        if (err) {
          logger.error('Signal failed', err);
          reject(err);
        }

        resolve();
      });
    });
  };

  _createClass(Room, [{
    key: "participantId",
    get: function get() {
      var _this$_session$connec2, _this$_session2, _this$_session2$conne;

      return (_this$_session$connec2 = (_this$_session2 = this._session) == null ? void 0 : (_this$_session2$conne = _this$_session2.connection) == null ? void 0 : _this$_session2$conne.connectionId) != null ? _this$_session$connec2 : '';
    }
  }, {
    key: "participantConnectionData",
    get: function get() {
      var _this$_session$connec3, _this$_session3, _this$_session3$conne;

      return (_this$_session$connec3 = (_this$_session3 = this._session) == null ? void 0 : (_this$_session3$conne = _this$_session3.connection) == null ? void 0 : _this$_session3$conne.data) != null ? _this$_session$connec3 : '';
    }
  }]);

  return Room;
}(events.EventEmitter);

var RoomWrapper = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(RoomWrapper, _EventEmitter);

  function RoomWrapper(props) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    _this.apiKey = props.apiKey;
    _this.roomId = props.sessionId;
    _this.token = props.token;
    _this.iceConfig = props.iceConfig;
    _this.roomContainer = props.roomContainer;
    _this.managedLayoutOptions = props.managedLayoutOptions;
    _this.mediaShutoffThreshold = props.mediaShutoffThreshold;
    _this.maxVideoParticipantsOnScreen = props.maxVideoParticipantsOnScreen;
    var room = new Room(props);
    _this.camera = room.camera;
    _this.screen = room.screen;
    _this.participants = room.participantWrappers;
    Object.defineProperty(_assertThisInitialized(_this), 'participantId', {
      get: function get() {
        return room.participantId;
      }
    });
    Object.defineProperty(_assertThisInitialized(_this), 'participantName', {
      get: function get() {
        return room.participantName;
      }
    });
    Object.defineProperty(_assertThisInitialized(_this), 'participantConnectionData', {
      get: function get() {
        return room.participantConnectionData;
      }
    });

    var _attachEventsToRoomWrapper = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee() {
        return runtime_1.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                room.on('connected', function () {
                  _this.emit('connected');
                });
                room.on('disconnected', function (reason) {
                  return _this.emit('disconnected', reason);
                });
                room.on('reconnecting', function () {
                  _this.emit('reconnecting');
                });
                room.on('reconnected', function () {
                  _this.emit('reconnected');
                });
                room.on('cameraPublisherMediaDisabled', function () {
                  _this.emit('cameraPublisherMediaDisabled');
                });
                room.on('cameraSubscriberVideoDisabled', function (id) {
                  _this.emit('cameraSubscriberVideoDisabled', id);
                });
                room.on('participantJoined', function (participant) {
                  _this.emit('participantJoined', participant);
                });
                room.on('participantLeft', function (participant, reason) {
                  _this.emit('participantLeft', participant, reason);
                });
                room.on('activeSpeakerChanged', function (participant) {
                  _this.emit('activeSpeakerChanged', participant);
                });
                room.on('signal', function (event) {
                  var _event$type$split$, _event$type, _event$type$split;

                  // type comes as 'signal:type' or just 'signal'
                  var strippedType = (_event$type$split$ = (_event$type = event.type) == null ? void 0 : (_event$type$split = _event$type.split('signal:')) == null ? void 0 : _event$type$split[1]) != null ? _event$type$split$ : '';

                  _this.emit('signal', event);

                  if (strippedType) {
                    _this.emit("signal:" + strippedType, event);
                  }
                });

              case 10:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function _attachEventsToRoomWrapper() {
        return _ref.apply(this, arguments);
      };
    }();

    _attachEventsToRoomWrapper();

    _this.join = function (publisherOptions) {
      if (publisherOptions === void 0) {
        publisherOptions = {};
      }

      return room.join(publisherOptions);
    };

    _this.leave = function () {
      return room.leave();
    };

    _this.setLayoutMode = function (mode) {
      return room.setLayoutMode(mode);
    };

    _this.startScreensharing = function (targetElement) {
      return room.startScreensharing(targetElement);
    };

    _this.stopScreensharing = function () {
      return room.stopScreensharing();
    };

    _this.signal = function (payload) {
      return room.signal(payload);
    };

    return _this;
  }

  return RoomWrapper;
}(events.EventEmitter);

var PreviewPublisher = /*#__PURE__*/function (_EventEmitter) {
  _inheritsLoose(PreviewPublisher, _EventEmitter);

  function PreviewPublisher(defaultTargetElement) {
    var _this;

    _this = _EventEmitter.call(this) || this;
    var analytics = new Analytics();
    _this._defaultTargetElement = defaultTargetElement;

    var _publisher = new Publisher();

    var _attachEventsToPreviewPublisher = function _attachEventsToPreviewPublisher() {
      _publisher.on('audioLevelUpdated', function (audioLevel) {
        _this.emit('audioLevelUpdated', audioLevel);
      });

      _publisher.on('videoElementCreated', function () {
        return _this.emit('created');
      });

      _publisher.on('destroyed', function () {
        return _this.emit('destroyed');
      });

      _publisher.on('accessAllowed', function () {
        return _this.emit('accessAllowed');
      });

      _publisher.on('accessDenied', function () {
        return _this.emit('accessDenied');
      });

      _publisher.on('accessDialogOpened', function () {
        return _this.emit('accessDialogOpened');
      });

      _publisher.on('accessDialogClosed', function (reason) {
        return _this.emit('accessDialogClosed', reason);
      });
    };

    _this.isVideoEnabled = function () {
      return _publisher.isVideoEnabled();
    };

    _this.isAudioEnabled = function () {
      return _publisher.isAudioEnabled();
    };

    _this.enableVideo = function () {
      analytics.log(logAction.previewPublisherEnableVideo, logVariation.attempt);

      _publisher.enableVideo();

      analytics.log(logAction.previewPublisherEnableVideo, logVariation.success);
    };

    _this.disableVideo = function () {
      analytics.log(logAction.previewPublisherDisableVideo, logVariation.attempt);

      _publisher.disableVideo();

      analytics.log(logAction.previewPublisherDisableVideo, logVariation.success);
    };

    _this.enableAudio = function () {
      analytics.log(logAction.previewPublisherEnableAudio, logVariation.attempt);

      _publisher.enableAudio();

      analytics.log(logAction.previewPublisherEnableAudio, logVariation.success);
    };

    _this.disableAudio = function () {
      analytics.log(logAction.previewPublisherDisableAudio, logVariation.attempt);

      _publisher.disableAudio();

      analytics.log(logAction.previewPublisherDisableAudio, logVariation.success);
    };

    _this.getVideoDevice = function () {
      return _publisher.getVideoDevice();
    };

    _this.setVideoDevice = function (deviceId) {
      return _publisher.setVideoDevice(deviceId);
    };

    _this.getAudioDevice = function () {
      return _publisher.getAudioDevice();
    };

    _this.setAudioDevice = function (deviceId) {
      return _publisher.setAudioDevice(deviceId);
    };

    _this.destroy = function () {
      analytics.log(logAction.destroyPreviewPublisher, logVariation.attempt);

      _publisher.destroyOTPublisher();

      analytics.log(logAction.destroyPreviewPublisher, logVariation.success);
    };

    _this.previewMedia = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(publisherOptions) {
        var _publisherOptions, targetElement, publisherProperties, target;

        return runtime_1.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (publisherOptions === void 0) {
                  publisherOptions = {};
                }

                _publisherOptions = publisherOptions, targetElement = _publisherOptions.targetElement, publisherProperties = _publisherOptions.publisherProperties;
                analytics.log(logAction.initPreviewPublisher, logVariation.attempt, {
                  publisherProperties: publisherProperties
                });
                target = getTargetElementFromDOM(targetElement != null ? targetElement : _this._defaultTargetElement);
                _context.prev = 4;

                _attachEventsToPreviewPublisher();

                _context.next = 8;
                return _publisher.initOTPublisher(target, publisherProperties);

              case 8:
                analytics.log(logAction.initPreviewPublisher, logVariation.success);
                _context.next = 15;
                break;

              case 11:
                _context.prev = 11;
                _context.t0 = _context["catch"](4);
                analytics.log(logAction.initPreviewPublisher, logVariation.failure, {
                  error: _context.t0
                });
                throw _context.t0;

              case 15:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, null, [[4, 11]]);
      }));

      return function (_x) {
        return _ref.apply(this, arguments);
      };
    }();

    _this.setVideoFilter = /*#__PURE__*/function () {
      var _ref2 = _asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee2(videoFilter) {
        return runtime_1.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.prev = 0;
                analytics.log(logAction.setVideoFilter, logVariation.attempt);
                _context2.next = 4;
                return _publisher.setVideoFilter(videoFilter);

              case 4:
                analytics.log(logAction.setVideoFilter, logVariation.success);
                _context2.next = 11;
                break;

              case 7:
                _context2.prev = 7;
                _context2.t0 = _context2["catch"](0);
                analytics.log(logAction.setVideoFilter, logVariation.failure, {
                  error: _context2.t0
                });
                throw _context2.t0;

              case 11:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, null, [[0, 7]]);
      }));

      return function (_x2) {
        return _ref2.apply(this, arguments);
      };
    }();

    _this.clearVideoFilter = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee3() {
      return runtime_1.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              analytics.log(logAction.clearVideoFilter, logVariation.attempt);
              _context3.prev = 1;
              _context3.next = 4;
              return _publisher.clearVideoFilter();

            case 4:
              analytics.log(logAction.clearVideoFilter, logVariation.success);
              _context3.next = 11;
              break;

            case 7:
              _context3.prev = 7;
              _context3.t0 = _context3["catch"](1);
              analytics.log(logAction.clearVideoFilter, logVariation.failure, {
                error: _context3.t0
              });
              throw _context3.t0;

            case 11:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3, null, [[1, 7]]);
    }));

    _this.setDisabledImageURI = function (imageURI) {
      _publisher.setDisabledImageURI(imageURI);
    };

    return _this;
  }

  return PreviewPublisher;
}(events.EventEmitter);

var analytics$1 = /*#__PURE__*/new Analytics();

var getActiveAudioOutputDevice = /*#__PURE__*/function () {
  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee() {
    var activeDevice;
    return runtime_1.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            analytics$1.log(logAction.getActiveAudioOutputDevice, logVariation.attempt);
            _context.prev = 1;
            _context.next = 4;
            return OT.getActiveAudioOutputDevice();

          case 4:
            activeDevice = _context.sent;
            analytics$1.log(logAction.getActiveAudioOutputDevice, logVariation.success);
            return _context.abrupt("return", activeDevice);

          case 9:
            _context.prev = 9;
            _context.t0 = _context["catch"](1);
            analytics$1.log(logAction.getActiveAudioOutputDevice, logVariation.failure);
            throw new Error('Not able to get active audio output device');

          case 13:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[1, 9]]);
  }));

  return function getActiveAudioOutputDevice() {
    return _ref.apply(this, arguments);
  };
}();

var analytics$2 = /*#__PURE__*/new Analytics();

var getAudioOutputDevices = /*#__PURE__*/function () {
  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee() {
    var devices;
    return runtime_1.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            analytics$2.log(logAction.getAudioOutputDevices, logVariation.attempt);
            _context.prev = 1;
            _context.next = 4;
            return OT.getAudioOutputDevices();

          case 4:
            devices = _context.sent;
            analytics$2.log(logAction.getAudioOutputDevices, logVariation.success);
            return _context.abrupt("return", devices);

          case 9:
            _context.prev = 9;
            _context.t0 = _context["catch"](1);
            analytics$2.log(logAction.getAudioOutputDevices, logVariation.failure);
            throw new Error('Not able to get available audio output device');

          case 13:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[1, 9]]);
  }));

  return function getAudioOutputDevices() {
    return _ref.apply(this, arguments);
  };
}();

var setProxyUrl = /*#__PURE__*/function () {
  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(proxyUrl) {
    var analytics;
    return runtime_1.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            ConfigStore.setProxyUrl(proxyUrl);
            _context.prev = 1;
            // Makes sure that OT-specific requests and events are proxied
            OT.setProxyUrl(proxyUrl); // Note: we instantiate after URL is configured

            analytics = new Analytics(); // Yes, this `attempt` log is misleading.  We log the attempt after we
            // already did it.  We can't log before setting the proxy url, since the
            // event will leak and not go through the proxy.

            analytics.log(logAction.setProxyUrl, logVariation.attempt);
            analytics.log(logAction.setProxyUrl, logVariation.success);
            _context.next = 11;
            break;

          case 8:
            _context.prev = 8;
            _context.t0 = _context["catch"](1);
            throw new Error('There is an issue with URL provided.');

          case 11:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[1, 8]]);
  }));

  return function setProxyUrl(_x) {
    return _ref.apply(this, arguments);
  };
}();

var setAudioOutputDevice = /*#__PURE__*/function () {
  var _ref = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/runtime_1.mark(function _callee(deviceId) {
    var analytics;
    return runtime_1.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            analytics = new Analytics();
            analytics.log(logAction.setAudioOutputDevice, logVariation.attempt);
            _context.prev = 2;
            logger.info('Set audio output device: ', deviceId);
            _context.next = 6;
            return OT.setAudioOutputDevice(deviceId);

          case 6:
            analytics.log(logAction.setAudioOutputDevice, logVariation.success);
            _context.next = 14;
            break;

          case 9:
            _context.prev = 9;
            _context.t0 = _context["catch"](2);
            analytics.log(logAction.setAudioOutputDevice, logVariation.failure);
            logger.warn('Not able to set the audio output device', deviceId);
            throw new Error('Not able to set the audio output device');

          case 14:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[2, 9]]);
  }));

  return function setAudioOutputDevice(_x) {
    return _ref.apply(this, arguments);
  };
}();

var hasMediaProcessorSupport = (function () {
  return OT.hasMediaProcessorSupport();
});

var _require = /*#__PURE__*/require('../package.json'),
    version = _require.publicVersion;

exports.PreviewPublisher = PreviewPublisher;
exports.Room = RoomWrapper;
exports.getActiveAudioOutputDevice = getActiveAudioOutputDevice;
exports.getAudioOutputDevices = getAudioOutputDevices;
exports.getDevices = getDevices;
exports.hasMediaProcessorSupport = hasMediaProcessorSupport;
exports.logLevel = logLevel;
exports.setAudioOutputDevice = setAudioOutputDevice;
exports.setLogLevel = setLogLevel;
exports.setProxyUrl = setProxyUrl;
exports.version = version;
//# sourceMappingURL=video-express.cjs.development.js.map
